#!/usr/bin/env bash
set -e
SUFFIX=`printf "integ\npreprod-eus\nprod-ae\nprod-cus\nprod-eus" | fzf`
if [[ "$SUFFIX" == "integ" ]]; then
    echo "Integ selected. Use tshdev to connect dev teleport first."
    tsh ssh -L 5432:db-pgsql-kds-integ-eastus.postgres.database.azure.com:5432 --insecure -N adminuser@jumphost-dev-eus
    exit 0
fi
echo "Logging into Teleport Kubernetes cluster - aks-cp-${SUFFIX}"
tsh kube login "aks-cp-${SUFFIX}"
export POD=$(kubectl get pod -n krypton-shared-temporal -l app.kubernetes.io/component=web -o jsonpath='{.items[0].metadata.name}')
echo "Temporal UI available at http://localhost:8080"
kubectl -n krypton-shared-temporal port-forward $POD 8080:8080

