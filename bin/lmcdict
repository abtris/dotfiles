#!/usr/bin/env php
<?php

$basePath = '/tmp';
$archivePath = $basePath . '/dictionaries.zip';
$buildUrl = 'http://hudson.int.lmc.cz/hudson/job/__vpv-dictionaries-build/lastSuccessfulBuild/artifact/dictionaries.zip';

file_put_contents($archivePath, file_get_contents($buildUrl));

$zip = new ZipArchive();
$res = $zip->open($archivePath);

if ($res !== TRUE) {
    die('failed to open zip');
}

$zip->extractTo($basePath);

$extractedPath = $basePath . '/aedit';
copy($extractedPath . '/public/www.jobs.cz/vocab_cz.js', '/srv/www/www.jobs.cz/current/www/js/vocab_cz.js');
copy($extractedPath . '/internal/www.jobs.cz/Dictionary2Cz.class.php', '/srv/www/www.jobs.cz/current/lib/Dictionary2Cz.class.php');
copy($extractedPath . '/internal/www.jobs.cz/Dictionary2Cz.xml', '/srv/www/www.jobs.cz/current/lib/Dictionary2Cz.xml');
rrmdir($extractedPath);
unlink($archivePath);

/** http://php.net/manual/en/function.rmdir.php */
function rrmdir($dir) {
   if (is_dir($dir)) {
     $objects = scandir($dir);
     foreach ($objects as $object) {
       if ($object != "." && $object != "..") {
         if (filetype($dir."/".$object) == "dir") rrmdir($dir."/".$object); else unlink($dir."/".$object);
       }
     }
     reset($objects);
     rmdir($dir);
   }
 }
