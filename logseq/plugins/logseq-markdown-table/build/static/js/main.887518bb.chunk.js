(this["webpackJsonplogseq-plugin-markdown-table"]=this["webpackJsonplogseq-plugin-markdown-table"]||[]).push([[0],{107:function(e){e.exports=JSON.parse('{"Markdown Table Editor":"Markdown Table Editor","Markdown table editor only support markdown":"Markdown table editor only support markdown format","Add New Table":"Add New Table","Cancel":"Cancel","Confirm":"Confirm","insert row above":"insert row above","insert row below":"insert row below","delete row":"delete row","insert column before":"insert column before","insert column after":"insert column after","delete column":"delete column","uuid error":"uuid error","markdown table overwrite success":"markdown table overwrite success","markdown table overwrite error":"markdown table overwrite error"}')},108:function(e){e.exports=JSON.parse('{"Markdown Table Editor":"Markdown \u8868\u683c\u7f16\u8f91\u5668","Markdown table editor only support markdown":"Markdown \u8868\u683c\u7f16\u8f91\u5668\u4ec5\u652f\u6301 Markdown \u683c\u5f0f","Add New Table":"\u6dfb\u52a0\u65b0\u8868\u683c","Cancel":"\u53d6\u6d88","Confirm":"\u786e\u8ba4","insert row above":"\u5728\u4e0a\u65b9\u63d2\u5165\u65b0\u884c","insert row below":"\u5728\u4e0b\u65b9\u63d2\u5165\u65b0\u884c","delete row":"\u5220\u9664\u884c","insert column before":"\u5728\u5de6\u4fa7\u63d2\u5165\u65b0\u5217","insert column after":"\u5728\u53f3\u4fa7\u63d2\u5165\u65b0\u5217","delete column":"\u5220\u9664\u5217","uuid error":"uuid \u9519\u8bef","markdown table overwrite success":"markdown \u8868\u683c\u8986\u76d6\u6210\u529f","markdown table overwrite error":"markdown \u8868\u683c\u8986\u76d6\u5931\u8d25"}')},215:function(e,t,n){},270:function(e,t,n){},271:function(e,t,n){"use strict";n.r(t);n(110);var r=n(0),o=n.n(r),a=n(19),c=n.n(a),i=(n(135),n(136),n(57)),l=n(16),s=n(3),u=n(2),d=n(280),b=n(1),f=n(34),m=function(e){var t=e.deleteBackward,n=e.deleteForward,r=e.insertBreak;return e.deleteBackward=function(n){var r=e.selection;if(r){var o=b.a.nodes(e,{match:function(e){return!b.a.isEditor(e)&&b.b.isElement(e)&&"table-cell"===e.type}}),a=Object(u.a)(o,1)[0],c=b.a.before(e,r),i=b.a.nodes(e,{at:c,match:function(e){return!b.a.isEditor(e)&&b.b.isElement&&"table-cell"===e.type}}),l=Object(u.a)(i,1)[0];if(a){var s=Object(u.a)(a,2)[1],d=b.a.start(e,s);if(b.e.equals(r.anchor,d))return}if(!a&&l)return}t(n)},e.deleteForward=function(t){var r=e.selection;if(r&&b.f.isCollapsed(r)){var o=b.a.nodes(e,{match:function(e){return!b.a.isEditor(e)&&b.b.isElement(e)&&"table-cell"===e.type}}),a=Object(u.a)(o,1)[0],c=b.a.after(e,r),i=b.a.nodes(e,{at:c,match:function(e){return!b.a.isEditor(e)&&b.b.isElement&&"table-cell"===e.type}}),l=Object(u.a)(i,1)[0];if(a){var s=Object(u.a)(a,2)[1],d=b.a.end(e,s);if(b.e.equals(r.anchor,d))return}if(!a&&l)return}n(t)},e.insertBreak=function(){if(e.selection){var t=b.a.nodes(e,{match:function(e){return!b.a.isEditor(e)&&b.b.isElement(e)&&"table"===e.type}});if(Object(u.a)(t,1)[0])return}r()},e},h=(n(138),n(35)),j=n(274),p=n(275),w=n(276),v=n(277),O=n(278),y=n(279),x=n(38),g=n(13),k=n(15),E="|||\n|--|--|\n|||",C=/^\|.+\|$/,T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=(e=e||E).trim().split("\n").filter(Boolean).map((function(e){return e.replaceAll("[:br]","\n")})),n=[t[0]].concat(t.slice(2)),r=n.map((function(e){var t=e.trim().split("|");return t.slice(1,t.length-1)}));return N(r)},A=function(e){return{type:"table-cell",children:[{text:e}]}},N=function(e){var t=Array.from(e,(function(e){return function(e){return{type:"table-row",children:Array.from(e,(function(e){return A(e)}))}}(e)}));return{type:"table",children:t}},M=n(97),S=function e(t){var n=this;Object(k.a)(this,e),this.insertTable=function(e,t){var r=b.a.nodes(n.editor,{match:function(e){return!b.a.isEditor(e)&&b.b.isElement(e)&&"table"===e.type},mode:"highest"});if(!Object(u.a)(r,1)[0]&&e&&t){var o=Array.from({length:e},(function(){return Array.from({length:t},(function(){return""}))})),a=N(o);b.h.insertNodes(n.editor,a,{mode:"highest"}),b.h.insertNodes(n.editor,{type:"paragraph",children:[{text:""}]},{mode:"highest"})}},this.insertCells=function(e,t,r,o){var a,c=r.anchor,i={row:null===c||void 0===c?void 0:c.path[1],column:null===c||void 0===c?void 0:c.path[2]},l=Array.from(e.children,(function(e){return Array.from(e.children,(function(e){return e.children[0].text}))})),u=l[0].length,d=Object(s.a)({},r);if("insert-row-above"===o){l.splice(i.row,0,Array(u).fill(""));var f=Object(g.a)(c.path);f.splice(1,1,i.row+1),d={anchor:Object(s.a)(Object(s.a)({},d.anchor),{},{path:f}),focus:Object(s.a)(Object(s.a)({},d.focus),{},{path:f})}}else if("insert-row-below"===o)l.splice(i.row+1,0,Array(u).fill(""));else if("insert-column-above"===o){l=Array.from(l,(function(e){var t=Object(g.a)(e);return t.splice(i.column,0,""),t}));var m=Object(g.a)(c.path);m.splice(2,1,i.column+1),d={anchor:Object(s.a)(Object(s.a)({},d.anchor),{},{path:m}),focus:Object(s.a)(Object(s.a)({},d.focus),{},{path:m})}}else if("insert-column-below"===o)l=Array.from(l,(function(e){var t=Object(g.a)(e);return t.splice(i.column+1,0,""),t}));else if("delete-row"===o&&(null===(a=l)||void 0===a?void 0:a.length)>1)l.splice(i.row,1);else{if(!("delete-column"===o&&u>1))return console.error("[insert cells run error]: unsupport action or can not delete",o,u);l=Array.from(l,(function(e){var t=Object(g.a)(e);return t.splice(i.column,1),t}))}n.removeTable();var h=N(l);b.h.insertNodes(n.editor,h,{at:t}),"delete-row"!==o&&"delete-column"!==o&&b.h.select(n.editor,d)},this.removeTable=function(){b.h.removeNodes(n.editor,{match:function(e){return!b.a.isEditor(e)&&b.b.isElement(e)&&"table"===e.type},mode:"highest"})},this.edit=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"insert-row-below",t=n.editor.selection;if(t&&b.f.isCollapsed(t)){var r=b.a.nodes(n.editor,{match:function(e){return!b.a.isEditor(e)&&b.b.isElement(e)&&"table"===e.type}}),o=Object(u.a)(r,1),a=o[0];if(a){var c=Object(u.a)(a,2),i=c[0],l=c[1];/^cursor-\w+/.test(e)?n.moveCursor(i,t,e):n.insertCells(i,l,t,e)}}},this.moveCursor=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"cursor-next",o=t.focus,a={row:null===o||void 0===o?void 0:o.path[1],column:null===o||void 0===o?void 0:o.path[2]},c=e.children.length,i=e.children[0].children.length;function l(t,n){var r=Object(M.get)(e.children,n.slice(1,3).map((function(e){return"[".concat(e,"].children")})).concat("[".concat(n[3],"].text")).join("")),o={path:n,offset:r.length};b.h.select(t,{anchor:o,focus:o})}if("cursor-next"===r){var s=Object(g.a)(o.path);a.column<i-1?s=[0,a.row,a.column+1,0]:a.row<c-1&&(s=[0,a.row+1,0,0]),l(n.editor,s)}else if("cursor-prev"===r){var u=Object(g.a)(o.path);a.column>0?u=[0,a.row,a.column-1,0]:a.row>0&&(u=[0,a.row-1,i-1,0]),l(n.editor,u)}},this.editor=t},B=n(7),_=function(){var e=Object(x.b)().t,t=Object(f.d)(),n=new S(t),r=function(e,t){e.preventDefault(),n.edit(t)};return Object(B.jsxs)("div",{className:"mb-2 space-x-2 bg-white inline-flex px-3 py-1 rounded-md shadow-sm",children:[Object(B.jsx)(h.a,{title:e("insert row above"),arrowPointAtCenter:!0,placement:"topLeft",children:Object(B.jsx)(j.a,{className:"text-xl cursor-pointer hover:opacity-70",onMouseDown:function(e){return r(e,"insert-row-above")}})}),Object(B.jsx)(h.a,{title:e("insert row below"),arrowPointAtCenter:!0,placement:"topLeft",children:Object(B.jsx)(p.a,{className:"text-xl cursor-pointer hover:opacity-70",onMouseDown:function(e){return r(e,"insert-row-below")}})}),Object(B.jsx)(h.a,{title:e("delete row"),arrowPointAtCenter:!0,placement:"topLeft",children:Object(B.jsx)(w.a,{className:"text-xl cursor-pointer hover:opacity-70",onMouseDown:function(e){return r(e,"delete-row")}})}),Object(B.jsx)("div",{className:"border-l border-gray-300"}),Object(B.jsx)(h.a,{title:e("insert column before"),arrowPointAtCenter:!0,placement:"topLeft",children:Object(B.jsx)(v.a,{className:"text-xl cursor-pointer hover:opacity-70",onMouseDown:function(e){return r(e,"insert-column-above")}})}),Object(B.jsx)(h.a,{title:e("insert column after"),arrowPointAtCenter:!0,placement:"topLeft",children:Object(B.jsx)(O.a,{className:"text-xl cursor-pointer hover:opacity-70",onMouseDown:function(e){return r(e,"insert-column-below")}})}),Object(B.jsx)(h.a,{title:e("delete column"),arrowPointAtCenter:!0,placement:"topLeft",children:Object(B.jsx)(y.a,{className:"text-xl cursor-pointer hover:opacity-70",onMouseDown:function(e){return r(e,"delete-column")}})})]})},I=function(e){var t=e.attributes,n=e.children;switch(e.element.type){case"table":return Object(B.jsx)("table",{children:Object(B.jsx)("tbody",Object(s.a)(Object(s.a)({},t),{},{children:n}))});case"table-row":return Object(B.jsx)("tr",Object(s.a)(Object(s.a)({},t),{},{children:n}));case"table-cell":return Object(B.jsx)("td",Object(s.a)(Object(s.a)({},t),{},{children:n}));default:return Object(B.jsx)("p",Object(s.a)(Object(s.a)({},t),{},{children:n}))}},D=function(e,t){var n=e.content,o=void 0===n?E:n,a=e.className,c=void 0===a?"":a,i=Object(r.useState)([T(o)]),l=Object(u.a)(i,2),d=l[0],h=l[1],j=Object(r.useMemo)((function(){return m(Object(f.e)(Object(b.i)()))}),[]),p=Object(r.useMemo)((function(){return new S(j)}),[j]),w=Object(r.useCallback)((function(e){return Object(B.jsx)(I,Object(s.a)({},e))}),[]);return Object(r.useImperativeHandle)(t,(function(){return{getEditorValue:function(){return d},onKeydown:function(e){f.b.isFocused(j)&&("Tab"===e?p.edit("cursor-next"):"ShiftTab"===e&&p.edit("cursor-prev"))}}}),[d,j,p]),Object(B.jsx)("div",{className:c,children:Object(B.jsxs)(f.c,{editor:j,value:d,onChange:h,children:[Object(B.jsx)(_,{}),Object(B.jsx)(f.a,{placeholder:"Write something",renderElement:w,onKeyDown:function(e){if("Enter"===e.key&&e.shiftKey)return j.insertText("\n"),!1}})]})})},P=Object(r.forwardRef)(D),L=(n(215),window.logseq),z=L.App,K=L.Editor,R="browser"===Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_ENV,U=function(e,t,n){return e.slice(t,n).filter((function(e){return C.test(e)})).join("\n")},F=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=e.split("\n"),r=[];t.forEach((function(e,t,o){var a=Object(u.a)(e,2),c=a[0],i=a[1],l=0===t?0:o[t-1][1];c===l||r.push({str:n.slice(l,c).join("\n"),type:"notTable"}),r.push({str:U(n,c,i),type:"table"})}));var o=Object(u.a)(t[t.length-1],2),a=o[1];return n.length-1>=a&&r.push({str:n.slice(a).join("\n"),type:"notTable"}),r},H=function(e){var t=e.content,n=e.tables,o=e.blockId,a=Object(x.b)().t,c=Object(r.useRef)({}),b=Object(r.useState)([]),f=Object(u.a)(b,2),m=f[0],h=f[1],j=function(){return L.hideMainUI()},p=Object(r.useCallback)((function(e){"Tab"===e.code&&!1===e.shiftKey?(e.preventDefault(),Object.keys(c.current).forEach((function(e){var t,n;null===(t=c.current)||void 0===t||null===(n=t[e])||void 0===n||n.onKeydown("Tab")}))):"Tab"===e.code&&e.shiftKey&&(e.preventDefault(),Object.keys(c.current).forEach((function(e){var t,n;null===(t=c.current)||void 0===t||null===(n=t[e])||void 0===n||n.onKeydown("ShiftTab")})))}),[]);return Object(r.useEffect)((function(){var e=F(t,n);h(e),console.log("[faiz:] === arrAfterSplitByTable",e)}),[t,n]),Object(r.useEffect)((function(){return window.addEventListener("keydown",p),function(){window.removeEventListener("keydown",p)}}),[p]),Object(B.jsxs)("div",{className:"w-screen h-screen flex flex-col justify-center items-center",children:[Object(B.jsx)("div",{className:"w-screen h-screen absolute",style:{background:"rgba(0, 0, 0, .3)",zIndex:-1},onClick:j}),Object(B.jsx)("div",{className:"w-2/3 overflow-y-auto",style:{maxHeight:"80%"},children:Object(B.jsx)("div",{className:"mt-2 flex flex-col",children:null===m||void 0===m?void 0:m.map((function(e,t){return"table"===(null===e||void 0===e?void 0:e.type)?Object(B.jsx)(P,{className:"my-2",content:null===e||void 0===e?void 0:e.str,ref:function(e){return function(e,t){c.current=Object(s.a)(Object(s.a)({},c.current),{},Object(l.a)({},e,t))}(t,e)}},t):Object(B.jsx)("div",{className:"bg-gray-400 text-gray-300 my-3 rounded px-1 py-2",style:{whiteSpace:"pre-line"},children:e.str},t)}))})}),Object(B.jsx)(i.a,{ghost:!0,className:"rounded mt-2 flex items-center",icon:Object(B.jsx)(d.a,{}),onClick:function(){h((function(e){return e.find((function(e){return"table"===e.type}))?e.concat([{type:"notTable",str:""},{type:"table",str:E}]):e.concat({type:"table",str:E})}))},children:a("Add New Table")}),Object(B.jsxs)("div",{className:"flex w-2/3 flex-row justify-end mt-4",children:[Object(B.jsx)(i.a,{className:"mr-1 rounded",onClick:j,children:a("Cancel")}),Object(B.jsx)(i.a,{className:"rounded",type:"primary",onClick:function(){if(!o&&!R)return z.UI.showMsg(a("uuid error"));var e=m.map((function(e,t){if("table"===e.type){var n,r,o,a=null===(n=c.current)||void 0===n||null===(r=n[t])||void 0===r||null===(o=r.getEditorValue())||void 0===o?void 0:o[0];return console.log("[faiz:] === slateVal",a),function(e){var t=Array.from(e.children,(function(e){var t=Array.from(e.children,(function(e){var t;return null===(t=e.children[0].text)||void 0===t?void 0:t.replaceAll("\n","[:br]")})).join("|");return"|".concat(t,"|")}));return t.splice(1,0,"|".concat(Array.from(e.children[0].children,(function(){return"--"})).join("|"),"|")),t.join("\n")}(a)}return e.str})).join("\n");if(R)return console.log("[faiz:] === save content:\n",e,"\nblockId:",o);K.updateBlock(o,e).then((function(){z.UI.showMsg(a("markdown table overwrite success")),L.hideMainUI()})).catch((function(e){z.UI.showMsg(a("markdown table overwrite error"),"warning"),console.log("[faiz:] === onClickConfirm error",e)}))},children:a("Confirm")})]})]})},V=n(106),q=new(n.n(V).a),W=function e(t){var n=t.split("\n"),r=q.parse(t,{}).filter((function(e){return"table_open"===(null===e||void 0===e?void 0:e.type)})).map((function(e){var t=Object(u.a)(e.map,2),r=t[0],o=t[1],a=n[o];if(C.test(a))return e.map;for(var c=-1;o>r;){if(C.test(n[o])){c=o;break}o--}return[r,c+1]}));return 0===(null===r||void 0===r?void 0:r.length)?(console.warn("[faiz:] === No Table Found"),e(t+="".concat(""===t?"":"\n").concat(E))):r},J=n(69),$={en:{translation:n(107)},"zh-CN":{translation:n(108)}};J.a.use(x.a).init({resources:$,lng:"en",fallbackLng:"en",interpolation:{escapeValue:!1}});var G=J.a,Q=(n(270),window.logseq),X=Q.Editor,Y=Q.App,Z="browser"===Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_ENV,ee=function(e,t){console.log("[faiz:] === Raw Input: \n",e);var n=W(e);console.log("[faiz:] === markdownIt parse res",n),function(e,t,n){c.a.render(Object(B.jsx)(o.a.StrictMode,{children:Object(B.jsx)(H,{content:e,tables:t,blockId:n})}),document.getElementById("root")),Z||Q.showMainUI()}(e,n,t)};Z?ee("foo\n`yarn install`\n|title1[:br]new line|title2|\n|--|--|\n|content1|content2|\n\n**bold**\nother\n\n|table2|table2|\n|--|--|\n|contentB|contentB|\n\n|table2|table2|\n|--|--|\n|contentB|contentB|\n|contentB|contentB|\n|contentB|contentB|\n|contentB|contentB|",111):Q.ready().then((function(){Q.App.getUserConfigs().then((function(e){G.changeLanguage(e.preferredLanguage||"en"),Q.provideStyle("\n        iframe#logseq-markdown-table.lsp-iframe-sandbox {\n          z-index: 10;\n        }\n      "),console.log("[faiz:] === markdown-table-editor-plugin loaded");var t=function(e){console.log("[faiz:] === woz-markdown-table-editor",e),X.getBlock(e.uuid).then((function(t){console.log("[faiz:] === block",t);var n=t.format,r=t.content;if("markdown"!==n)return Y.UI.showMsg(G.t("Markdown table editor only support markdown"),"warning");ee(r,e.uuid)}))};X.registerBlockContextMenuItem(G.t("Markdown Table Editor"),t),X.registerSlashCommand("Markdown Table Editor",t),Q.on("ui:visible:changed",(function(e){e.visible||c.a.unmountComponentAtNode(document.getElementById("root"))}))}))}))}},[[271,1,2]]]);
//# sourceMappingURL=main.887518bb.chunk.js.map