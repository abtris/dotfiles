(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const A of document.querySelectorAll('link[rel="modulepreload"]'))D(A);new MutationObserver(A=>{for(const ee of A)if(ee.type==="childList")for(const F of ee.addedNodes)F.tagName==="LINK"&&F.rel==="modulepreload"&&D(F)}).observe(document,{childList:!0,subtree:!0});function v(A){const ee={};return A.integrity&&(ee.integrity=A.integrity),A.referrerPolicy&&(ee.referrerPolicy=A.referrerPolicy),A.crossOrigin==="use-credentials"?ee.credentials="include":A.crossOrigin==="anonymous"?ee.credentials="omit":ee.credentials="same-origin",ee}function D(A){if(A.ep)return;A.ep=!0;const ee=v(A);fetch(A.href,ee)}})();var An=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Gi(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var Mn={exports:{}};/*! For license information please see lsplugin.user.js.LICENSE.txt */Mn.exports;(function(l,s){(function(v,D){l.exports=D()})(self,()=>(()=>{var v={227:(F,c,O)=>{var I=O(155);c.formatArgs=function(H){if(H[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+H[0]+(this.useColors?"%c ":" ")+"+"+F.exports.humanize(this.diff),!this.useColors)return;const K="color: "+this.color;H.splice(1,0,K,"color: inherit");let _=0,g=0;H[0].replace(/%[a-zA-Z%]/g,k=>{k!=="%%"&&(_++,k==="%c"&&(g=_))}),H.splice(g,0,K)},c.save=function(H){try{H?c.storage.setItem("debug",H):c.storage.removeItem("debug")}catch{}},c.load=function(){let H;try{H=c.storage.getItem("debug")}catch{}return!H&&I!==void 0&&"env"in I&&(H=I.env.DEBUG),H},c.useColors=function(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},c.storage=function(){try{return localStorage}catch{}}(),c.destroy=(()=>{let H=!1;return()=>{H||(H=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),c.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],c.log=console.debug||console.log||(()=>{}),F.exports=O(447)(c);const{formatters:T}=F.exports;T.j=function(H){try{return JSON.stringify(H)}catch(K){return"[UnexpectedJSONParseError]: "+K.message}}},447:(F,c,O)=>{F.exports=function(I){function T(_){let g,k,f,S=null;function w(...M){if(!w.enabled)return;const z=w,P=Number(new Date),R=P-(g||P);z.diff=R,z.prev=g,z.curr=P,g=P,M[0]=T.coerce(M[0]),typeof M[0]!="string"&&M.unshift("%O");let o=0;M[0]=M[0].replace(/%([a-zA-Z%])/g,(d,y)=>{if(d==="%%")return"%";o++;const b=T.formatters[y];if(typeof b=="function"){const V=M[o];d=b.call(z,V),M.splice(o,1),o--}return d}),T.formatArgs.call(z,M),(z.log||T.log).apply(z,M)}return w.namespace=_,w.useColors=T.useColors(),w.color=T.selectColor(_),w.extend=H,w.destroy=T.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>S!==null?S:(k!==T.namespaces&&(k=T.namespaces,f=T.enabled(_)),f),set:M=>{S=M}}),typeof T.init=="function"&&T.init(w),w}function H(_,g){const k=T(this.namespace+(g===void 0?":":g)+_);return k.log=this.log,k}function K(_){return _.toString().substring(2,_.toString().length-2).replace(/\.\*\?$/,"*")}return T.debug=T,T.default=T,T.coerce=function(_){return _ instanceof Error?_.stack||_.message:_},T.disable=function(){const _=[...T.names.map(K),...T.skips.map(K).map(g=>"-"+g)].join(",");return T.enable(""),_},T.enable=function(_){let g;T.save(_),T.namespaces=_,T.names=[],T.skips=[];const k=(typeof _=="string"?_:"").split(/[\s,]+/),f=k.length;for(g=0;g<f;g++)k[g]&&((_=k[g].replace(/\*/g,".*?"))[0]==="-"?T.skips.push(new RegExp("^"+_.slice(1)+"$")):T.names.push(new RegExp("^"+_+"$")))},T.enabled=function(_){if(_[_.length-1]==="*")return!0;let g,k;for(g=0,k=T.skips.length;g<k;g++)if(T.skips[g].test(_))return!1;for(g=0,k=T.names.length;g<k;g++)if(T.names[g].test(_))return!0;return!1},T.humanize=O(824),T.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(I).forEach(_=>{T[_]=I[_]}),T.names=[],T.skips=[],T.formatters={},T.selectColor=function(_){let g=0;for(let k=0;k<_.length;k++)g=(g<<5)-g+_.charCodeAt(k),g|=0;return T.colors[Math.abs(g)%T.colors.length]},T.enable(T.load()),T}},996:F=>{var c=function(f){return function(S){return!!S&&typeof S=="object"}(f)&&!function(S){var w=Object.prototype.toString.call(S);return w==="[object RegExp]"||w==="[object Date]"||function(M){return M.$$typeof===O}(S)}(f)},O=typeof Symbol=="function"&&Symbol.for?Symbol.for("react.element"):60103;function I(f,S){return S.clone!==!1&&S.isMergeableObject(f)?g((w=f,Array.isArray(w)?[]:{}),f,S):f;var w}function T(f,S,w){return f.concat(S).map(function(M){return I(M,w)})}function H(f){return Object.keys(f).concat(function(S){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(S).filter(function(w){return Object.propertyIsEnumerable.call(S,w)}):[]}(f))}function K(f,S){try{return S in f}catch{return!1}}function _(f,S,w){var M={};return w.isMergeableObject(f)&&H(f).forEach(function(z){M[z]=I(f[z],w)}),H(S).forEach(function(z){(function(P,R){return K(P,R)&&!(Object.hasOwnProperty.call(P,R)&&Object.propertyIsEnumerable.call(P,R))})(f,z)||(K(f,z)&&w.isMergeableObject(S[z])?M[z]=function(P,R){if(!R.customMerge)return g;var o=R.customMerge(P);return typeof o=="function"?o:g}(z,w)(f[z],S[z],w):M[z]=I(S[z],w))}),M}function g(f,S,w){(w=w||{}).arrayMerge=w.arrayMerge||T,w.isMergeableObject=w.isMergeableObject||c,w.cloneUnlessOtherwiseSpecified=I;var M=Array.isArray(S);return M===Array.isArray(f)?M?w.arrayMerge(f,S,w):_(f,S,w):I(S,w)}g.all=function(f,S){if(!Array.isArray(f))throw new Error("first argument should be an array");return f.reduce(function(w,M){return g(w,M,S)},{})};var k=g;F.exports=k},856:function(F){F.exports=function(){function c(E){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(N){return typeof N}:function(N){return N&&typeof Symbol=="function"&&N.constructor===Symbol&&N!==Symbol.prototype?"symbol":typeof N},c(E)}function O(E,N){return O=Object.setPrototypeOf||function(G,Z){return G.__proto__=Z,G},O(E,N)}function I(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function T(E,N,G){return T=I()?Reflect.construct:function(Z,me,He){var Ve=[null];Ve.push.apply(Ve,me);var it=new(Function.bind.apply(Z,Ve));return He&&O(it,He.prototype),it},T.apply(null,arguments)}function H(E){return K(E)||_(E)||g(E)||f()}function K(E){if(Array.isArray(E))return k(E)}function _(E){if(typeof Symbol<"u"&&E[Symbol.iterator]!=null||E["@@iterator"]!=null)return Array.from(E)}function g(E,N){if(E){if(typeof E=="string")return k(E,N);var G=Object.prototype.toString.call(E).slice(8,-1);return G==="Object"&&E.constructor&&(G=E.constructor.name),G==="Map"||G==="Set"?Array.from(E):G==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(G)?k(E,N):void 0}}function k(E,N){(N==null||N>E.length)&&(N=E.length);for(var G=0,Z=new Array(N);G<N;G++)Z[G]=E[G];return Z}function f(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var S=Object.hasOwnProperty,w=Object.setPrototypeOf,M=Object.isFrozen,z=Object.getPrototypeOf,P=Object.getOwnPropertyDescriptor,R=Object.freeze,o=Object.seal,d=Object.create,y=typeof Reflect<"u"&&Reflect,b=y.apply,V=y.construct;b||(b=function(E,N,G){return E.apply(N,G)}),R||(R=function(E){return E}),o||(o=function(E){return E}),V||(V=function(E,N){return T(E,H(N))});var ne=te(Array.prototype.forEach),se=te(Array.prototype.pop),ge=te(Array.prototype.push),ke=te(String.prototype.toLowerCase),Ce=te(String.prototype.match),_e=te(String.prototype.replace),jt=te(String.prototype.indexOf),h=te(String.prototype.trim),x=te(RegExp.prototype.test),B=Ee(TypeError);function te(E){return function(N){for(var G=arguments.length,Z=new Array(G>1?G-1:0),me=1;me<G;me++)Z[me-1]=arguments[me];return b(E,N,Z)}}function Ee(E){return function(){for(var N=arguments.length,G=new Array(N),Z=0;Z<N;Z++)G[Z]=arguments[Z];return V(E,G)}}function q(E,N){w&&w(E,null);for(var G=N.length;G--;){var Z=N[G];if(typeof Z=="string"){var me=ke(Z);me!==Z&&(M(N)||(N[G]=me),Z=me)}E[Z]=!0}return E}function Y(E){var N,G=d(null);for(N in E)b(S,E,[N])&&(G[N]=E[N]);return G}function ae(E,N){for(;E!==null;){var G=P(E,N);if(G){if(G.get)return te(G.get);if(typeof G.value=="function")return te(G.value)}E=z(E)}function Z(me){return console.warn("fallback value for",me),null}return Z}var Ae=R(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Se=R(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Me=R(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),rt=R(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),fe=R(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),ue=R(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Oe=R(["#text"]),Le=R(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),qe=R(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Ke=R(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Fe=R(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Ie=o(/\{\{[\w\W]*|[\w\W]*\}\}/gm),gt=o(/<%[\w\W]*|[\w\W]*%>/gm),Rn=o(/^data-[\-\w.\u00B7-\uFFFF]/),$e=o(/^aria-[\-\w]+$/),Je=o(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),an=o(/^(?:\w+script|data):/i),Nn=o(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),qn=o(/^html$/i),mt=function(){return typeof window>"u"?null:window},$n=function(E,N){if(c(E)!=="object"||typeof E.createPolicy!="function")return null;var G=null,Z="data-tt-policy-suffix";N.currentScript&&N.currentScript.hasAttribute(Z)&&(G=N.currentScript.getAttribute(Z));var me="dompurify"+(G?"#"+G:"");try{return E.createPolicy(me,{createHTML:function(He){return He}})}catch{return console.warn("TrustedTypes policy "+me+" could not be created."),null}};function sn(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:mt(),N=function(i){return sn(i)};if(N.version="2.3.8",N.removed=[],!E||!E.document||E.document.nodeType!==9)return N.isSupported=!1,N;var G=E.document,Z=E.document,me=E.DocumentFragment,He=E.HTMLTemplateElement,Ve=E.Node,it=E.Element,Dt=E.NodeFilter,ln=E.NamedNodeMap,Xe=ln===void 0?E.NamedNodeMap||E.MozNamedAttrMap:ln,Hn=E.HTMLFormElement,Un=E.DOMParser,Dn=E.trustedTypes,At=it.prototype,zn=ae(At,"cloneNode"),Bn=ae(At,"nextSibling"),Wn=ae(At,"childNodes"),zt=ae(At,"parentNode");if(typeof He=="function"){var Ue=Z.createElement("template");Ue.content&&Ue.content.ownerDocument&&(Z=Ue.content.ownerDocument)}var De=$n(Dn,G),cn=De?De.createHTML(""):"",Lt=Z,Bt=Lt.implementation,ot=Lt.createNodeIterator,un=Lt.createDocumentFragment,dn=Lt.getElementsByTagName,Gn=G.importNode,pn={};try{pn=Y(Z).documentMode?Z.documentMode:{}}catch{}var Re={};N.isSupported=typeof zt=="function"&&Bt&&Bt.createHTMLDocument!==void 0&&pn!==9;var vt,Qe,It=Ie,Pt=gt,Wt=Rn,Jn=$e,fn=an,Mt=Nn,re=Je,ve=null,hn=q({},[].concat(H(Ae),H(Se),H(Me),H(fe),H(Oe))),ye=null,at=q({},[].concat(H(Le),H(qe),H(Ke),H(Fe))),de=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),st=null,Ft=null,Gt=!0,Jt=!0,gn=!1,lt=!1,et=!1,Vt=!1,Qt=!1,ct=!1,Rt=!1,ut=!1,mn=!0,Yt=!0,dt=!1,ze={},pt=null,vn=q({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),yn=null,bn=q({},["audio","video","img","source","image","track"]),Zt=null,tt=q({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),ft="http://www.w3.org/1998/Math/MathML",Kt="http://www.w3.org/2000/svg",Ye="http://www.w3.org/1999/xhtml",Nt=Ye,wn=!1,yt=["application/xhtml+xml","text/html"],bt="text/html",ht=null,Vn=Z.createElement("form"),_n=function(i){return i instanceof RegExp||i instanceof Function},Xt=function(i){ht&&ht===i||(i&&c(i)==="object"||(i={}),i=Y(i),ve="ALLOWED_TAGS"in i?q({},i.ALLOWED_TAGS):hn,ye="ALLOWED_ATTR"in i?q({},i.ALLOWED_ATTR):at,Zt="ADD_URI_SAFE_ATTR"in i?q(Y(tt),i.ADD_URI_SAFE_ATTR):tt,yn="ADD_DATA_URI_TAGS"in i?q(Y(bn),i.ADD_DATA_URI_TAGS):bn,pt="FORBID_CONTENTS"in i?q({},i.FORBID_CONTENTS):vn,st="FORBID_TAGS"in i?q({},i.FORBID_TAGS):{},Ft="FORBID_ATTR"in i?q({},i.FORBID_ATTR):{},ze="USE_PROFILES"in i&&i.USE_PROFILES,Gt=i.ALLOW_ARIA_ATTR!==!1,Jt=i.ALLOW_DATA_ATTR!==!1,gn=i.ALLOW_UNKNOWN_PROTOCOLS||!1,lt=i.SAFE_FOR_TEMPLATES||!1,et=i.WHOLE_DOCUMENT||!1,ct=i.RETURN_DOM||!1,Rt=i.RETURN_DOM_FRAGMENT||!1,ut=i.RETURN_TRUSTED_TYPE||!1,Qt=i.FORCE_BODY||!1,mn=i.SANITIZE_DOM!==!1,Yt=i.KEEP_CONTENT!==!1,dt=i.IN_PLACE||!1,re=i.ALLOWED_URI_REGEXP||re,Nt=i.NAMESPACE||Ye,i.CUSTOM_ELEMENT_HANDLING&&_n(i.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(de.tagNameCheck=i.CUSTOM_ELEMENT_HANDLING.tagNameCheck),i.CUSTOM_ELEMENT_HANDLING&&_n(i.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(de.attributeNameCheck=i.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),i.CUSTOM_ELEMENT_HANDLING&&typeof i.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(de.allowCustomizedBuiltInElements=i.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),vt=vt=yt.indexOf(i.PARSER_MEDIA_TYPE)===-1?bt:i.PARSER_MEDIA_TYPE,Qe=vt==="application/xhtml+xml"?function(L){return L}:ke,lt&&(Jt=!1),Rt&&(ct=!0),ze&&(ve=q({},H(Oe)),ye=[],ze.html===!0&&(q(ve,Ae),q(ye,Le)),ze.svg===!0&&(q(ve,Se),q(ye,qe),q(ye,Fe)),ze.svgFilters===!0&&(q(ve,Me),q(ye,qe),q(ye,Fe)),ze.mathMl===!0&&(q(ve,fe),q(ye,Ke),q(ye,Fe))),i.ADD_TAGS&&(ve===hn&&(ve=Y(ve)),q(ve,i.ADD_TAGS)),i.ADD_ATTR&&(ye===at&&(ye=Y(ye)),q(ye,i.ADD_ATTR)),i.ADD_URI_SAFE_ATTR&&q(Zt,i.ADD_URI_SAFE_ATTR),i.FORBID_CONTENTS&&(pt===vn&&(pt=Y(pt)),q(pt,i.FORBID_CONTENTS)),Yt&&(ve["#text"]=!0),et&&q(ve,["html","head","body"]),ve.table&&(q(ve,["tbody"]),delete st.tbody),R&&R(i),ht=i)},xn=q({},["mi","mo","mn","ms","mtext"]),kn=q({},["foreignobject","desc","title","annotation-xml"]),Qn=q({},["title","style","font","a","script"]),Be=q({},Se);q(Be,Me),q(Be,rt);var qt=q({},fe);q(qt,ue);var Yn=function(i){var L=zt(i);L&&L.tagName||(L={namespaceURI:Ye,tagName:"template"});var C=ke(i.tagName),ie=ke(L.tagName);return i.namespaceURI===Kt?L.namespaceURI===Ye?C==="svg":L.namespaceURI===ft?C==="svg"&&(ie==="annotation-xml"||xn[ie]):!!Be[C]:i.namespaceURI===ft?L.namespaceURI===Ye?C==="math":L.namespaceURI===Kt?C==="math"&&kn[ie]:!!qt[C]:i.namespaceURI===Ye&&!(L.namespaceURI===Kt&&!kn[ie])&&!(L.namespaceURI===ft&&!xn[ie])&&!qt[C]&&(Qn[C]||!Be[C])},We=function(i){ge(N.removed,{element:i});try{i.parentNode.removeChild(i)}catch{try{i.outerHTML=cn}catch{i.remove()}}},wt=function(i,L){try{ge(N.removed,{attribute:L.getAttributeNode(i),from:L})}catch{ge(N.removed,{attribute:null,from:L})}if(L.removeAttribute(i),i==="is"&&!ye[i])if(ct||Rt)try{We(L)}catch{}else try{L.setAttribute(i,"")}catch{}},Sn=function(i){var L,C;if(Qt)i="<remove></remove>"+i;else{var ie=Ce(i,/^[\r\n\t ]+/);C=ie&&ie[0]}vt==="application/xhtml+xml"&&(i='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+i+"</body></html>");var he=De?De.createHTML(i):i;if(Nt===Ye)try{L=new Un().parseFromString(he,vt)}catch{}if(!L||!L.documentElement){L=Bt.createDocument(Nt,"template",null);try{L.documentElement.innerHTML=wn?"":he}catch{}}var xe=L.body||L.documentElement;return i&&C&&xe.insertBefore(Z.createTextNode(C),xe.childNodes[0]||null),Nt===Ye?dn.call(L,et?"html":"body")[0]:et?L.documentElement:xe},Cn=function(i){return ot.call(i.ownerDocument||i,i,Dt.SHOW_ELEMENT|Dt.SHOW_COMMENT|Dt.SHOW_TEXT,null,!1)},Zn=function(i){return i instanceof Hn&&(typeof i.nodeName!="string"||typeof i.textContent!="string"||typeof i.removeChild!="function"||!(i.attributes instanceof Xe)||typeof i.removeAttribute!="function"||typeof i.setAttribute!="function"||typeof i.namespaceURI!="string"||typeof i.insertBefore!="function")},_t=function(i){return c(Ve)==="object"?i instanceof Ve:i&&c(i)==="object"&&typeof i.nodeType=="number"&&typeof i.nodeName=="string"},Te=function(i,L,C){Re[i]&&ne(Re[i],function(ie){ie.call(N,L,C,ht)})},xt=function(i){var L;if(Te("beforeSanitizeElements",i,null),Zn(i)||x(/[\u0080-\uFFFF]/,i.nodeName))return We(i),!0;var C=Qe(i.nodeName);if(Te("uponSanitizeElement",i,{tagName:C,allowedTags:ve}),i.hasChildNodes()&&!_t(i.firstElementChild)&&(!_t(i.content)||!_t(i.content.firstElementChild))&&x(/<[/\w]/g,i.innerHTML)&&x(/<[/\w]/g,i.textContent)||C==="select"&&x(/<template/i,i.innerHTML))return We(i),!0;if(!ve[C]||st[C]){if(!st[C]&&nt(C)&&(de.tagNameCheck instanceof RegExp&&x(de.tagNameCheck,C)||de.tagNameCheck instanceof Function&&de.tagNameCheck(C)))return!1;if(Yt&&!pt[C]){var ie=zt(i)||i.parentNode,he=Wn(i)||i.childNodes;if(he&&ie)for(var xe=he.length-1;xe>=0;--xe)ie.insertBefore(zn(he[xe],!0),Bn(i))}return We(i),!0}return i instanceof it&&!Yn(i)?(We(i),!0):C!=="noscript"&&C!=="noembed"||!x(/<\/no(script|embed)/i,i.innerHTML)?(lt&&i.nodeType===3&&(L=i.textContent,L=_e(L,It," "),L=_e(L,Pt," "),i.textContent!==L&&(ge(N.removed,{element:i.cloneNode()}),i.textContent=L)),Te("afterSanitizeElements",i,null),!1):(We(i),!0)},En=function(i,L,C){if(mn&&(L==="id"||L==="name")&&(C in Z||C in Vn))return!1;if(!(Jt&&!Ft[L]&&x(Wt,L))){if(!(Gt&&x(Jn,L))){if(!ye[L]||Ft[L]){if(!(nt(i)&&(de.tagNameCheck instanceof RegExp&&x(de.tagNameCheck,i)||de.tagNameCheck instanceof Function&&de.tagNameCheck(i))&&(de.attributeNameCheck instanceof RegExp&&x(de.attributeNameCheck,L)||de.attributeNameCheck instanceof Function&&de.attributeNameCheck(L))||L==="is"&&de.allowCustomizedBuiltInElements&&(de.tagNameCheck instanceof RegExp&&x(de.tagNameCheck,C)||de.tagNameCheck instanceof Function&&de.tagNameCheck(C))))return!1}else if(!Zt[L]){if(!x(re,_e(C,Mt,""))){if((L!=="src"&&L!=="xlink:href"&&L!=="href"||i==="script"||jt(C,"data:")!==0||!yn[i])&&!(gn&&!x(fn,_e(C,Mt,"")))){if(C)return!1}}}}}return!0},nt=function(i){return i.indexOf("-")>0},kt=function(i){var L,C,ie,he;Te("beforeSanitizeAttributes",i,null);var xe=i.attributes;if(xe){var be={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ye};for(he=xe.length;he--;){var St=L=xe[he],Ze=St.name,Pe=St.namespaceURI;if(C=Ze==="value"?L.value:h(L.value),ie=Qe(Ze),be.attrName=ie,be.attrValue=C,be.keepAttr=!0,be.forceKeepAttr=void 0,Te("uponSanitizeAttribute",i,be),C=be.attrValue,!be.forceKeepAttr&&(wt(Ze,i),be.keepAttr))if(x(/\/>/i,C))wt(Ze,i);else{lt&&(C=_e(C,It," "),C=_e(C,Pt," "));var en=Qe(i.nodeName);if(En(en,ie,C))try{Pe?i.setAttributeNS(Pe,Ze,C):i.setAttribute(Ze,C),se(N.removed)}catch{}}}Te("afterSanitizeAttributes",i,null)}},Kn=function i(L){var C,ie=Cn(L);for(Te("beforeSanitizeShadowDOM",L,null);C=ie.nextNode();)Te("uponSanitizeShadowNode",C,null),xt(C)||(C.content instanceof me&&i(C.content),kt(C));Te("afterSanitizeShadowDOM",L,null)};return N.sanitize=function(i,L){var C,ie,he,xe,be;if((wn=!i)&&(i="<!-->"),typeof i!="string"&&!_t(i)){if(typeof i.toString!="function")throw B("toString is not a function");if(typeof(i=i.toString())!="string")throw B("dirty is not a string, aborting")}if(!N.isSupported){if(c(E.toStaticHTML)==="object"||typeof E.toStaticHTML=="function"){if(typeof i=="string")return E.toStaticHTML(i);if(_t(i))return E.toStaticHTML(i.outerHTML)}return i}if(Vt||Xt(L),N.removed=[],typeof i=="string"&&(dt=!1),dt){if(i.nodeName){var St=Qe(i.nodeName);if(!ve[St]||st[St])throw B("root node is forbidden and cannot be sanitized in-place")}}else if(i instanceof Ve)(ie=(C=Sn("<!---->")).ownerDocument.importNode(i,!0)).nodeType===1&&ie.nodeName==="BODY"||ie.nodeName==="HTML"?C=ie:C.appendChild(ie);else{if(!ct&&!lt&&!et&&i.indexOf("<")===-1)return De&&ut?De.createHTML(i):i;if(!(C=Sn(i)))return ct?null:ut?cn:""}C&&Qt&&We(C.firstChild);for(var Ze=Cn(dt?i:C);he=Ze.nextNode();)he.nodeType===3&&he===xe||xt(he)||(he.content instanceof me&&Kn(he.content),kt(he),xe=he);if(xe=null,dt)return i;if(ct){if(Rt)for(be=un.call(C.ownerDocument);C.firstChild;)be.appendChild(C.firstChild);else be=C;return ye.shadowroot&&(be=Gn.call(G,be,!0)),be}var Pe=et?C.outerHTML:C.innerHTML;return et&&ve["!doctype"]&&C.ownerDocument&&C.ownerDocument.doctype&&C.ownerDocument.doctype.name&&x(qn,C.ownerDocument.doctype.name)&&(Pe="<!DOCTYPE "+C.ownerDocument.doctype.name+`>
`+Pe),lt&&(Pe=_e(Pe,It," "),Pe=_e(Pe,Pt," ")),De&&ut?De.createHTML(Pe):Pe},N.setConfig=function(i){Xt(i),Vt=!0},N.clearConfig=function(){ht=null,Vt=!1},N.isValidAttribute=function(i,L,C){ht||Xt({});var ie=Qe(i),he=Qe(L);return En(ie,he,C)},N.addHook=function(i,L){typeof L=="function"&&(Re[i]=Re[i]||[],ge(Re[i],L))},N.removeHook=function(i){if(Re[i])return se(Re[i])},N.removeHooks=function(i){Re[i]&&(Re[i]=[])},N.removeAllHooks=function(){Re={}},N}return sn()}()},729:F=>{var c=Object.prototype.hasOwnProperty,O="~";function I(){}function T(g,k,f){this.fn=g,this.context=k,this.once=f||!1}function H(g,k,f,S,w){if(typeof f!="function")throw new TypeError("The listener must be a function");var M=new T(f,S||g,w),z=O?O+k:k;return g._events[z]?g._events[z].fn?g._events[z]=[g._events[z],M]:g._events[z].push(M):(g._events[z]=M,g._eventsCount++),g}function K(g,k){--g._eventsCount==0?g._events=new I:delete g._events[k]}function _(){this._events=new I,this._eventsCount=0}Object.create&&(I.prototype=Object.create(null),new I().__proto__||(O=!1)),_.prototype.eventNames=function(){var g,k,f=[];if(this._eventsCount===0)return f;for(k in g=this._events)c.call(g,k)&&f.push(O?k.slice(1):k);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(g)):f},_.prototype.listeners=function(g){var k=O?O+g:g,f=this._events[k];if(!f)return[];if(f.fn)return[f.fn];for(var S=0,w=f.length,M=new Array(w);S<w;S++)M[S]=f[S].fn;return M},_.prototype.listenerCount=function(g){var k=O?O+g:g,f=this._events[k];return f?f.fn?1:f.length:0},_.prototype.emit=function(g,k,f,S,w,M){var z=O?O+g:g;if(!this._events[z])return!1;var P,R,o=this._events[z],d=arguments.length;if(o.fn){switch(o.once&&this.removeListener(g,o.fn,void 0,!0),d){case 1:return o.fn.call(o.context),!0;case 2:return o.fn.call(o.context,k),!0;case 3:return o.fn.call(o.context,k,f),!0;case 4:return o.fn.call(o.context,k,f,S),!0;case 5:return o.fn.call(o.context,k,f,S,w),!0;case 6:return o.fn.call(o.context,k,f,S,w,M),!0}for(R=1,P=new Array(d-1);R<d;R++)P[R-1]=arguments[R];o.fn.apply(o.context,P)}else{var y,b=o.length;for(R=0;R<b;R++)switch(o[R].once&&this.removeListener(g,o[R].fn,void 0,!0),d){case 1:o[R].fn.call(o[R].context);break;case 2:o[R].fn.call(o[R].context,k);break;case 3:o[R].fn.call(o[R].context,k,f);break;case 4:o[R].fn.call(o[R].context,k,f,S);break;default:if(!P)for(y=1,P=new Array(d-1);y<d;y++)P[y-1]=arguments[y];o[R].fn.apply(o[R].context,P)}}return!0},_.prototype.on=function(g,k,f){return H(this,g,k,f,!1)},_.prototype.once=function(g,k,f){return H(this,g,k,f,!0)},_.prototype.removeListener=function(g,k,f,S){var w=O?O+g:g;if(!this._events[w])return this;if(!k)return K(this,w),this;var M=this._events[w];if(M.fn)M.fn!==k||S&&!M.once||f&&M.context!==f||K(this,w);else{for(var z=0,P=[],R=M.length;z<R;z++)(M[z].fn!==k||S&&!M[z].once||f&&M[z].context!==f)&&P.push(M[z]);P.length?this._events[w]=P.length===1?P[0]:P:K(this,w)}return this},_.prototype.removeAllListeners=function(g){var k;return g?(k=O?O+g:g,this._events[k]&&K(this,k)):(this._events=new I,this._eventsCount=0),this},_.prototype.off=_.prototype.removeListener,_.prototype.addListener=_.prototype.on,_.prefixed=O,_.EventEmitter=_,F.exports=_},717:F=>{typeof Object.create=="function"?F.exports=function(c,O){c.super_=O,c.prototype=Object.create(O.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}})}:F.exports=function(c,O){c.super_=O;var I=function(){};I.prototype=O.prototype,c.prototype=new I,c.prototype.constructor=c}},824:F=>{var c=1e3,O=60*c,I=60*O,T=24*I,H=7*T,K=365.25*T;function _(g,k,f,S){var w=k>=1.5*f;return Math.round(g/f)+" "+S+(w?"s":"")}F.exports=function(g,k){k=k||{};var f=typeof g;if(f==="string"&&g.length>0)return function(S){if(!((S=String(S)).length>100)){var w=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(S);if(w){var M=parseFloat(w[1]);switch((w[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return M*K;case"weeks":case"week":case"w":return M*H;case"days":case"day":case"d":return M*T;case"hours":case"hour":case"hrs":case"hr":case"h":return M*I;case"minutes":case"minute":case"mins":case"min":case"m":return M*O;case"seconds":case"second":case"secs":case"sec":case"s":return M*c;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return M;default:return}}}}(g);if(f==="number"&&isFinite(g))return k.long?function(S){var w=Math.abs(S);return w>=T?_(S,w,T,"day"):w>=I?_(S,w,I,"hour"):w>=O?_(S,w,O,"minute"):w>=c?_(S,w,c,"second"):S+" ms"}(g):function(S){var w=Math.abs(S);return w>=T?Math.round(S/T)+"d":w>=I?Math.round(S/I)+"h":w>=O?Math.round(S/O)+"m":w>=c?Math.round(S/c)+"s":S+"ms"}(g);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(g))}},520:(F,c,O)=>{var I=O(155),T=I.platform==="win32",H=O(539);function K(o,d){for(var y=[],b=0;b<o.length;b++){var V=o[b];V&&V!=="."&&(V===".."?y.length&&y[y.length-1]!==".."?y.pop():d&&y.push(".."):y.push(V))}return y}function _(o){for(var d=o.length-1,y=0;y<=d&&!o[y];y++);for(var b=d;b>=0&&!o[b];b--);return y===0&&b===d?o:y>b?[]:o.slice(y,b+1)}var g=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,k=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/,f={};function S(o){var d=g.exec(o),y=(d[1]||"")+(d[2]||""),b=d[3]||"",V=k.exec(b);return[y,V[1],V[2],V[3]]}function w(o){var d=g.exec(o),y=d[1]||"",b=!!y&&y[1]!==":";return{device:y,isUnc:b,isAbsolute:b||!!d[2],tail:d[3]}}function M(o){return"\\\\"+o.replace(/^[\\\/]+/,"").replace(/[\\\/]+/g,"\\")}f.resolve=function(){for(var o="",d="",y=!1,b=arguments.length-1;b>=-1;b--){var V;if(b>=0?V=arguments[b]:o?(V=I.env["="+o])&&V.substr(0,3).toLowerCase()===o.toLowerCase()+"\\"||(V=o+"\\"):V=I.cwd(),!H.isString(V))throw new TypeError("Arguments to path.resolve must be strings");if(V){var ne=w(V),se=ne.device,ge=ne.isUnc,ke=ne.isAbsolute,Ce=ne.tail;if((!se||!o||se.toLowerCase()===o.toLowerCase())&&(o||(o=se),y||(d=Ce+"\\"+d,y=ke),o&&y))break}}return ge&&(o=M(o)),o+(y?"\\":"")+(d=K(d.split(/[\\\/]+/),!y).join("\\"))||"."},f.normalize=function(o){var d=w(o),y=d.device,b=d.isUnc,V=d.isAbsolute,ne=d.tail,se=/[\\\/]$/.test(ne);return(ne=K(ne.split(/[\\\/]+/),!V).join("\\"))||V||(ne="."),ne&&se&&(ne+="\\"),b&&(y=M(y)),y+(V?"\\":"")+ne},f.isAbsolute=function(o){return w(o).isAbsolute},f.join=function(){for(var o=[],d=0;d<arguments.length;d++){var y=arguments[d];if(!H.isString(y))throw new TypeError("Arguments to path.join must be strings");y&&o.push(y)}var b=o.join("\\");return/^[\\\/]{2}[^\\\/]/.test(o[0])||(b=b.replace(/^[\\\/]{2,}/,"\\")),f.normalize(b)},f.relative=function(o,d){o=f.resolve(o),d=f.resolve(d);for(var y=o.toLowerCase(),b=d.toLowerCase(),V=_(d.split("\\")),ne=_(y.split("\\")),se=_(b.split("\\")),ge=Math.min(ne.length,se.length),ke=ge,Ce=0;Ce<ge;Ce++)if(ne[Ce]!==se[Ce]){ke=Ce;break}if(ke==0)return d;var _e=[];for(Ce=ke;Ce<ne.length;Ce++)_e.push("..");return(_e=_e.concat(V.slice(ke))).join("\\")},f._makeLong=function(o){if(!H.isString(o))return o;if(!o)return"";var d=f.resolve(o);return/^[a-zA-Z]\:\\/.test(d)?"\\\\?\\"+d:/^\\\\[^?.]/.test(d)?"\\\\?\\UNC\\"+d.substring(2):o},f.dirname=function(o){var d=S(o),y=d[0],b=d[1];return y||b?(b&&(b=b.substr(0,b.length-1)),y+b):"."},f.basename=function(o,d){var y=S(o)[2];return d&&y.substr(-1*d.length)===d&&(y=y.substr(0,y.length-d.length)),y},f.extname=function(o){return S(o)[3]},f.format=function(o){if(!H.isObject(o))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof o);var d=o.root||"";if(!H.isString(d))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof o.root);var y=o.dir,b=o.base||"";return y?y[y.length-1]===f.sep?y+b:y+f.sep+b:b},f.parse=function(o){if(!H.isString(o))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof o);var d=S(o);if(!d||d.length!==4)throw new TypeError("Invalid path '"+o+"'");return{root:d[0],dir:d[0]+d[1].slice(0,-1),base:d[2],ext:d[3],name:d[2].slice(0,d[2].length-d[3].length)}},f.sep="\\",f.delimiter=";";var z=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,P={};function R(o){return z.exec(o).slice(1)}P.resolve=function(){for(var o="",d=!1,y=arguments.length-1;y>=-1&&!d;y--){var b=y>=0?arguments[y]:I.cwd();if(!H.isString(b))throw new TypeError("Arguments to path.resolve must be strings");b&&(o=b+"/"+o,d=b[0]==="/")}return(d?"/":"")+(o=K(o.split("/"),!d).join("/"))||"."},P.normalize=function(o){var d=P.isAbsolute(o),y=o&&o[o.length-1]==="/";return(o=K(o.split("/"),!d).join("/"))||d||(o="."),o&&y&&(o+="/"),(d?"/":"")+o},P.isAbsolute=function(o){return o.charAt(0)==="/"},P.join=function(){for(var o="",d=0;d<arguments.length;d++){var y=arguments[d];if(!H.isString(y))throw new TypeError("Arguments to path.join must be strings");y&&(o+=o?"/"+y:y)}return P.normalize(o)},P.relative=function(o,d){o=P.resolve(o).substr(1),d=P.resolve(d).substr(1);for(var y=_(o.split("/")),b=_(d.split("/")),V=Math.min(y.length,b.length),ne=V,se=0;se<V;se++)if(y[se]!==b[se]){ne=se;break}var ge=[];for(se=ne;se<y.length;se++)ge.push("..");return(ge=ge.concat(b.slice(ne))).join("/")},P._makeLong=function(o){return o},P.dirname=function(o){var d=R(o),y=d[0],b=d[1];return y||b?(b&&(b=b.substr(0,b.length-1)),y+b):"."},P.basename=function(o,d){var y=R(o)[2];return d&&y.substr(-1*d.length)===d&&(y=y.substr(0,y.length-d.length)),y},P.extname=function(o){return R(o)[3]},P.format=function(o){if(!H.isObject(o))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof o);var d=o.root||"";if(!H.isString(d))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof o.root);return(o.dir?o.dir+P.sep:"")+(o.base||"")},P.parse=function(o){if(!H.isString(o))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof o);var d=R(o);if(!d||d.length!==4)throw new TypeError("Invalid path '"+o+"'");return d[1]=d[1]||"",d[2]=d[2]||"",d[3]=d[3]||"",{root:d[0],dir:d[0]+d[1].slice(0,-1),base:d[2],ext:d[3],name:d[2].slice(0,d[2].length-d[3].length)}},P.sep="/",P.delimiter=":",F.exports=T?f:P,F.exports.posix=P,F.exports.win32=f},155:F=>{var c,O,I=F.exports={};function T(){throw new Error("setTimeout has not been defined")}function H(){throw new Error("clearTimeout has not been defined")}function K(P){if(c===setTimeout)return setTimeout(P,0);if((c===T||!c)&&setTimeout)return c=setTimeout,setTimeout(P,0);try{return c(P,0)}catch{try{return c.call(null,P,0)}catch{return c.call(this,P,0)}}}(function(){try{c=typeof setTimeout=="function"?setTimeout:T}catch{c=T}try{O=typeof clearTimeout=="function"?clearTimeout:H}catch{O=H}})();var _,g=[],k=!1,f=-1;function S(){k&&_&&(k=!1,_.length?g=_.concat(g):f=-1,g.length&&w())}function w(){if(!k){var P=K(S);k=!0;for(var R=g.length;R;){for(_=g,g=[];++f<R;)_&&_[f].run();f=-1,R=g.length}_=null,k=!1,function(o){if(O===clearTimeout)return clearTimeout(o);if((O===H||!O)&&clearTimeout)return O=clearTimeout,clearTimeout(o);try{O(o)}catch{try{return O.call(null,o)}catch{return O.call(this,o)}}}(P)}}function M(P,R){this.fun=P,this.array=R}function z(){}I.nextTick=function(P){var R=new Array(arguments.length-1);if(arguments.length>1)for(var o=1;o<arguments.length;o++)R[o-1]=arguments[o];g.push(new M(P,R)),g.length!==1||k||K(w)},M.prototype.run=function(){this.fun.apply(null,this.array)},I.title="browser",I.browser=!0,I.env={},I.argv=[],I.version="",I.versions={},I.on=z,I.addListener=z,I.once=z,I.off=z,I.removeListener=z,I.removeAllListeners=z,I.emit=z,I.prependListener=z,I.prependOnceListener=z,I.listeners=function(P){return[]},I.binding=function(P){throw new Error("process.binding is not supported")},I.cwd=function(){return"/"},I.chdir=function(P){throw new Error("process.chdir is not supported")},I.umask=function(){return 0}},384:F=>{F.exports=function(c){return c&&typeof c=="object"&&typeof c.copy=="function"&&typeof c.fill=="function"&&typeof c.readUInt8=="function"}},539:(F,c,O)=>{var I=O(155),T=/%[sdj%]/g;c.format=function(h){if(!o(h)){for(var x=[],B=0;B<arguments.length;B++)x.push(_(arguments[B]));return x.join(" ")}B=1;for(var te=arguments,Ee=te.length,q=String(h).replace(T,function(ae){if(ae==="%%")return"%";if(B>=Ee)return ae;switch(ae){case"%s":return String(te[B++]);case"%d":return Number(te[B++]);case"%j":try{return JSON.stringify(te[B++])}catch{return"[Circular]"}default:return ae}}),Y=te[B];B<Ee;Y=te[++B])P(Y)||!b(Y)?q+=" "+Y:q+=" "+_(Y);return q},c.deprecate=function(h,x){if(d(O.g.process))return function(){return c.deprecate(h,x).apply(this,arguments)};if(I.noDeprecation===!0)return h;var B=!1;return function(){if(!B){if(I.throwDeprecation)throw new Error(x);I.traceDeprecation?console.trace(x):console.error(x),B=!0}return h.apply(this,arguments)}};var H,K={};function _(h,x){var B={seen:[],stylize:k};return arguments.length>=3&&(B.depth=arguments[2]),arguments.length>=4&&(B.colors=arguments[3]),z(x)?B.showHidden=x:x&&c._extend(B,x),d(B.showHidden)&&(B.showHidden=!1),d(B.depth)&&(B.depth=2),d(B.colors)&&(B.colors=!1),d(B.customInspect)&&(B.customInspect=!0),B.colors&&(B.stylize=g),f(B,h,B.depth)}function g(h,x){var B=_.styles[x];return B?"\x1B["+_.colors[B][0]+"m"+h+"\x1B["+_.colors[B][1]+"m":h}function k(h,x){return h}function f(h,x,B){if(h.customInspect&&x&&se(x.inspect)&&x.inspect!==c.inspect&&(!x.constructor||x.constructor.prototype!==x)){var te=x.inspect(B,h);return o(te)||(te=f(h,te,B)),te}var Ee=function(fe,ue){if(d(ue))return fe.stylize("undefined","undefined");if(o(ue)){var Oe="'"+JSON.stringify(ue).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return fe.stylize(Oe,"string")}if(R(ue))return fe.stylize(""+ue,"number");if(z(ue))return fe.stylize(""+ue,"boolean");if(P(ue))return fe.stylize("null","null")}(h,x);if(Ee)return Ee;var q=Object.keys(x),Y=function(fe){var ue={};return fe.forEach(function(Oe,Le){ue[Oe]=!0}),ue}(q);if(h.showHidden&&(q=Object.getOwnPropertyNames(x)),ne(x)&&(q.indexOf("message")>=0||q.indexOf("description")>=0))return S(x);if(q.length===0){if(se(x)){var ae=x.name?": "+x.name:"";return h.stylize("[Function"+ae+"]","special")}if(y(x))return h.stylize(RegExp.prototype.toString.call(x),"regexp");if(V(x))return h.stylize(Date.prototype.toString.call(x),"date");if(ne(x))return S(x)}var Ae,Se="",Me=!1,rt=["{","}"];return M(x)&&(Me=!0,rt=["[","]"]),se(x)&&(Se=" [Function"+(x.name?": "+x.name:"")+"]"),y(x)&&(Se=" "+RegExp.prototype.toString.call(x)),V(x)&&(Se=" "+Date.prototype.toUTCString.call(x)),ne(x)&&(Se=" "+S(x)),q.length!==0||Me&&x.length!=0?B<0?y(x)?h.stylize(RegExp.prototype.toString.call(x),"regexp"):h.stylize("[Object]","special"):(h.seen.push(x),Ae=Me?function(fe,ue,Oe,Le,qe){for(var Ke=[],Fe=0,Ie=ue.length;Fe<Ie;++Fe)jt(ue,String(Fe))?Ke.push(w(fe,ue,Oe,Le,String(Fe),!0)):Ke.push("");return qe.forEach(function(gt){gt.match(/^\d+$/)||Ke.push(w(fe,ue,Oe,Le,gt,!0))}),Ke}(h,x,B,Y,q):q.map(function(fe){return w(h,x,B,Y,fe,Me)}),h.seen.pop(),function(fe,ue,Oe){return fe.reduce(function(Le,qe){return qe.indexOf(`
`)>=0,Le+qe.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?Oe[0]+(ue===""?"":ue+`
 `)+" "+fe.join(`,
  `)+" "+Oe[1]:Oe[0]+ue+" "+fe.join(", ")+" "+Oe[1]}(Ae,Se,rt)):rt[0]+Se+rt[1]}function S(h){return"["+Error.prototype.toString.call(h)+"]"}function w(h,x,B,te,Ee,q){var Y,ae,Ae;if((Ae=Object.getOwnPropertyDescriptor(x,Ee)||{value:x[Ee]}).get?ae=Ae.set?h.stylize("[Getter/Setter]","special"):h.stylize("[Getter]","special"):Ae.set&&(ae=h.stylize("[Setter]","special")),jt(te,Ee)||(Y="["+Ee+"]"),ae||(h.seen.indexOf(Ae.value)<0?(ae=P(B)?f(h,Ae.value,null):f(h,Ae.value,B-1)).indexOf(`
`)>-1&&(ae=q?ae.split(`
`).map(function(Se){return"  "+Se}).join(`
`).substr(2):`
`+ae.split(`
`).map(function(Se){return"   "+Se}).join(`
`)):ae=h.stylize("[Circular]","special")),d(Y)){if(q&&Ee.match(/^\d+$/))return ae;(Y=JSON.stringify(""+Ee)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(Y=Y.substr(1,Y.length-2),Y=h.stylize(Y,"name")):(Y=Y.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),Y=h.stylize(Y,"string"))}return Y+": "+ae}function M(h){return Array.isArray(h)}function z(h){return typeof h=="boolean"}function P(h){return h===null}function R(h){return typeof h=="number"}function o(h){return typeof h=="string"}function d(h){return h===void 0}function y(h){return b(h)&&ge(h)==="[object RegExp]"}function b(h){return typeof h=="object"&&h!==null}function V(h){return b(h)&&ge(h)==="[object Date]"}function ne(h){return b(h)&&(ge(h)==="[object Error]"||h instanceof Error)}function se(h){return typeof h=="function"}function ge(h){return Object.prototype.toString.call(h)}function ke(h){return h<10?"0"+h.toString(10):h.toString(10)}c.debuglog=function(h){if(d(H)&&(H=I.env.NODE_DEBUG||""),h=h.toUpperCase(),!K[h])if(new RegExp("\\b"+h+"\\b","i").test(H)){var x=I.pid;K[h]=function(){var B=c.format.apply(c,arguments);console.error("%s %d: %s",h,x,B)}}else K[h]=function(){};return K[h]},c.inspect=_,_.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},_.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=M,c.isBoolean=z,c.isNull=P,c.isNullOrUndefined=function(h){return h==null},c.isNumber=R,c.isString=o,c.isSymbol=function(h){return typeof h=="symbol"},c.isUndefined=d,c.isRegExp=y,c.isObject=b,c.isDate=V,c.isError=ne,c.isFunction=se,c.isPrimitive=function(h){return h===null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||typeof h=="symbol"||h===void 0},c.isBuffer=O(384);var Ce=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function _e(){var h=new Date,x=[ke(h.getHours()),ke(h.getMinutes()),ke(h.getSeconds())].join(":");return[h.getDate(),Ce[h.getMonth()],x].join(" ")}function jt(h,x){return Object.prototype.hasOwnProperty.call(h,x)}c.log=function(){console.log("%s - %s",_e(),c.format.apply(c,arguments))},c.inherits=O(717),c._extend=function(h,x){if(!x||!b(x))return h;for(var B=Object.keys(x),te=B.length;te--;)h[B[te]]=x[B[te]];return h}}},D={};function A(F){var c=D[F];if(c!==void 0)return c.exports;var O=D[F]={exports:{}};return v[F].call(O.exports,O,O.exports,A),O.exports}A.n=F=>{var c=F&&F.__esModule?()=>F.default:()=>F;return A.d(c,{a:c}),c},A.d=(F,c)=>{for(var O in c)A.o(c,O)&&!A.o(F,O)&&Object.defineProperty(F,O,{enumerable:!0,get:c[O]})},A.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),A.o=(F,c)=>Object.prototype.hasOwnProperty.call(F,c),A.r=F=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(F,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(F,"__esModule",{value:!0})};var ee={};return(()=>{A.r(ee),A.d(ee,{LSPluginUser:()=>ar,setupPluginUserInstance:()=>qr});var F=A(520),c=(A(856),A(996)),O=A.n(c),I=function(){return I=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},I.apply(this,arguments)};function T(t){return t.toLowerCase()}var H=[/([a-z0-9])([A-Z])/g,/([A-Z])([A-Z][a-z])/g],K=/[^A-Z0-9]+/gi;function _(t,e,n){return e instanceof RegExp?t.replace(e,n):e.reduce(function(r,a){return r.replace(a,n)},t)}function g(t,e){return e===void 0&&(e={}),function(n,r){r===void 0&&(r={});for(var a=r.splitRegexp,u=a===void 0?H:a,p=r.stripRegexp,m=p===void 0?K:p,j=r.transform,U=j===void 0?T:j,W=r.delimiter,$=W===void 0?" ":W,J=_(_(n,u,"$1\0$2"),m,"\0"),X=0,Q=J.length;J.charAt(X)==="\0";)X++;for(;J.charAt(Q-1)==="\0";)Q--;return J.slice(X,Q).split("\0").map(U).join($)}(t,I({delimiter:"."},e))}var k=A(729),f=A.n(k);function S(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const w=navigator.platform.toLowerCase()==="win32"?F.win32:F.posix,M=function(t,e){return e===void 0&&(e={}),g(t,I({delimiter:"_"},e))};class z extends f(){constructor(e,n){super(),S(this,"_tag",void 0),S(this,"_opts",void 0),S(this,"_logs",[]),this._tag=e,this._opts=n}write(e,n,r){var a;n!=null&&n.length&&n[n.length-1]===!0&&(r=!0,n.pop());const u=n.reduce((m,j)=>(j&&j instanceof Error?m+=`${j.message} ${j.stack}`:m+=j.toString(),m),`[${this._tag}][${new Date().toLocaleTimeString()}] `);var p;this._logs.push([e,u]),(r||(a=this._opts)!==null&&a!==void 0&&a.console)&&((p=console)===null||p===void 0||p[e==="ERROR"?"error":"debug"](`${e}: ${u}`)),this.emit("change")}clear(){this._logs=[],this.emit("change")}info(...e){this.write("INFO",e)}error(...e){this.write("ERROR",e)}warn(...e){this.write("WARN",e)}setTag(e){this._tag=e}toJSON(){return this._logs}}function P(t,...e){try{const n=new URL(t);if(!n.origin)throw new Error(null);const r=w.join(t.substr(n.origin.length),...e);return n.origin+r}catch{return w.join(t,...e)}}function R(t,e){let n,r,a=!1;const u=m=>j=>{t&&clearTimeout(t),m(j),a=!0},p=new Promise((m,j)=>{n=u(m),r=u(j),t&&(t=setTimeout(()=>r(new Error(`[deferred timeout] ${e}`)),t))});return{created:Date.now(),setTag:m=>e=m,resolve:n,reject:r,promise:p,get settled(){return a}}}const o=new Map;window.__injectedUIEffects=o;var d=A(227),y=A.n(d);function b(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const V="application/x-postmate-v1+json";let ne=0;const se={handshake:1,"handshake-reply":1,call:1,emit:1,reply:1,request:1},ge=(t,e)=>(typeof e!="string"||t.origin===e)&&!!t.data&&(typeof t.data!="object"||"postmate"in t.data)&&t.data.type===V&&!!se[t.data.postmate];class ke{constructor(e){b(this,"parent",void 0),b(this,"frame",void 0),b(this,"child",void 0),b(this,"events",{}),b(this,"childOrigin",void 0),b(this,"listener",void 0),this.parent=e.parent,this.frame=e.frame,this.child=e.child,this.childOrigin=e.childOrigin,this.listener=n=>{if(!ge(n,this.childOrigin))return!1;const{data:r,name:a}=((n||{}).data||{}).value||{};n.data.postmate==="emit"&&a in this.events&&this.events[a].forEach(u=>{u.call(this,r)})},this.parent.addEventListener("message",this.listener,!1)}get(e,...n){return new Promise((r,a)=>{const u=++ne,p=m=>{m.data.uid===u&&m.data.postmate==="reply"&&(this.parent.removeEventListener("message",p,!1),m.data.error?a(m.data.error):r(m.data.value))};this.parent.addEventListener("message",p,!1),this.child.postMessage({postmate:"request",type:V,property:e,args:n,uid:u},this.childOrigin)})}call(e,n){this.child.postMessage({postmate:"call",type:V,property:e,data:n},this.childOrigin)}on(e,n){this.events[e]||(this.events[e]=[]),this.events[e].push(n)}destroy(){window.removeEventListener("message",this.listener,!1),this.frame.parentNode.removeChild(this.frame)}}class Ce{constructor(e){b(this,"model",void 0),b(this,"parent",void 0),b(this,"parentOrigin",void 0),b(this,"child",void 0),this.model=e.model,this.parent=e.parent,this.parentOrigin=e.parentOrigin,this.child=e.child,this.child.addEventListener("message",n=>{if(!ge(n,this.parentOrigin))return;const{property:r,uid:a,data:u,args:p}=n.data;n.data.postmate!=="call"?((m,j,U)=>{const W=typeof m[j]=="function"?m[j].apply(null,U):m[j];return Promise.resolve(W)})(this.model,r,p).then(m=>{n.source.postMessage({property:r,postmate:"reply",type:V,uid:a,value:m},n.origin)}).catch(m=>{n.source.postMessage({property:r,postmate:"reply",type:V,uid:a,error:m},n.origin)}):r in this.model&&typeof this.model[r]=="function"&&this.model[r](u)})}emit(e,n){this.parent.postMessage({postmate:"emit",type:V,value:{name:e,data:n}},this.parentOrigin)}}class _e{constructor(e){b(this,"container",void 0),b(this,"parent",void 0),b(this,"frame",void 0),b(this,"child",void 0),b(this,"childOrigin",void 0),b(this,"url",void 0),b(this,"model",void 0),this.container=e.container,this.url=e.url,this.parent=window,this.frame=document.createElement("iframe"),e.id&&(this.frame.id=e.id),e.name&&(this.frame.name=e.name),this.frame.classList.add.apply(this.frame.classList,e.classListArray||[]),this.container.appendChild(this.frame),this.child=this.frame.contentWindow,this.model=e.model||{}}sendHandshake(e){const n=(u=>{const p=document.createElement("a");p.href=u;const m=p.protocol.length>4?p.protocol:window.location.protocol,j=p.host.length?p.port==="80"||p.port==="443"?p.hostname:p.host:window.location.host;return p.origin||`${m}//${j}`})(e=e||this.url);let r,a=0;return new Promise((u,p)=>{const m=U=>!!ge(U,n)&&(U.data.postmate==="handshake-reply"?(clearInterval(r),this.parent.removeEventListener("message",m,!1),this.childOrigin=U.origin,u(new ke(this))):p("Failed handshake"));this.parent.addEventListener("message",m,!1);const j=()=>{a++,this.child.postMessage({postmate:"handshake",type:V,model:this.model},n),a===5&&clearInterval(r)};this.frame.addEventListener("load",()=>{j(),r=setInterval(j,500)}),this.frame.src=e})}destroy(){this.frame.parentNode.removeChild(this.frame)}}b(_e,"debug",!1),b(_e,"Model",void 0);class jt{constructor(e){b(this,"child",void 0),b(this,"model",void 0),b(this,"parent",void 0),b(this,"parentOrigin",void 0),this.child=window,this.model=e,this.parent=this.child.parent}sendHandshakeReply(){return new Promise((e,n)=>{const r=a=>{if(a.data.postmate){if(a.data.postmate==="handshake"){this.child.removeEventListener("message",r,!1),a.source.postMessage({postmate:"handshake-reply",type:V},a.origin),this.parentOrigin=a.origin;const u=a.data.model;return u&&Object.keys(u).forEach(p=>{this.model[p]=u[p]}),e(new Ce(this))}return n("Handshake Reply Failed")}};this.child.addEventListener("message",r,!1)})}}function h(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const{importHTML:x,createSandboxContainer:B}=window.QSandbox||{};function te(t,e){return t.startsWith("http")?fetch(t,e):(t=t.replace("file://",""),new Promise(async(n,r)=>{try{const a=await window.apis.doAction(["readFile",t]);n({text:()=>a})}catch(a){console.error(a),r(a)}}))}class Ee extends f(){constructor(e){super(),h(this,"_pluginLocal",void 0),h(this,"_frame",void 0),h(this,"_root",void 0),h(this,"_loaded",!1),h(this,"_unmountFns",[]),this._pluginLocal=e,e._dispose(()=>{this._unmount()})}async load(){const{name:e,entry:n}=this._pluginLocal.options;if(this.loaded||!n)return;const{template:r,execScripts:a}=await x(n,{fetch:te});this._mount(r,document.body);const u=B(e,{elementGetter:()=>{var m;return(m=this._root)===null||m===void 0?void 0:m.firstChild}}).instance.proxy;u.__shadow_mode__=!0,u.LSPluginLocal=this._pluginLocal,u.LSPluginShadow=this,u.LSPluginUser=u.logseq=new ar(this._pluginLocal.toJSON(),this._pluginLocal.caller);const p=await a(u,!0);this._unmountFns.push(p.unmount),this._loaded=!0}_mount(e,n){const r=this._frame=document.createElement("div");r.classList.add("lsp-shadow-sandbox"),r.id=this._pluginLocal.id,this._root=r.attachShadow({mode:"open"}),this._root.innerHTML=`<div>${e}</div>`,n.appendChild(r),this.emit("mounted")}_unmount(){for(const e of this._unmountFns)e&&e.call(null)}destroy(){var e,n;(e=this.frame)===null||e===void 0||(n=e.parentNode)===null||n===void 0||n.removeChild(this.frame)}get loaded(){return this._loaded}get document(){var e;return(e=this._root)===null||e===void 0?void 0:e.firstChild}get frame(){return this._frame}}function q(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const Y=y()("LSPlugin:caller"),ae="#await#response#",Ae="#lspmsg#",Se="#lspmsg#error#",Me=t=>`#lspmsg#${t}`;class rt extends f(){constructor(e){super(),q(this,"_pluginLocal",void 0),q(this,"_connected",!1),q(this,"_parent",void 0),q(this,"_child",void 0),q(this,"_shadow",void 0),q(this,"_status",void 0),q(this,"_userModel",{}),q(this,"_call",void 0),q(this,"_callUserModel",void 0),q(this,"_debugTag",""),this._pluginLocal=e,e&&(this._debugTag=e.debugTag)}async connectToChild(){if(this._connected)return;const{shadow:e}=this._pluginLocal;e?await this._setupShadowSandbox():await this._setupIframeSandbox()}async connectToParent(e={}){if(this._connected)return;const n=this,r=this._pluginLocal!=null;let a=0;const u=new Map,p=R(6e4),m=this._extendUserModel({"#lspmsg#ready#":async W=>{m[Me(W?.pid)]=({type:$,payload:J})=>{Y(`[host (_call) -> *user] ${this._debugTag}`,$,J),n.emit($,J)},await p.resolve()},"#lspmsg#beforeunload#":async W=>{const $=R(1e4);n.emit("beforeunload",Object.assign({actor:$},W)),await $.promise},"#lspmsg#settings#":async({type:W,payload:$})=>{n.emit("settings:changed",$)},[Ae]:async({ns:W,type:$,payload:J})=>{Y(`[host (async) -> *user] ${this._debugTag} ns=${W} type=${$}`,J),W&&W.startsWith("hook")?n.emit(`${W}:${$}`,J):n.emit($,J)},"#lspmsg#reply#":({_sync:W,result:$})=>{if(Y(`[sync host -> *user] #${W}`,$),u.has(W)){const J=u.get(W);J&&($!=null&&$.hasOwnProperty(Se)?J.reject($[Se]):J.resolve($),u.delete(W))}},...e});var j;if(r)return await p.promise,JSON.parse(JSON.stringify((j=this._pluginLocal)===null||j===void 0?void 0:j.toJSON()));const U=new jt(m).sendHandshakeReply();return this._status="pending",await U.then(W=>{this._child=W,this._connected=!0,this._call=async($,J={},X)=>{if(X){const Q=++a;u.set(Q,X),J._sync=Q,X.setTag(`async call #${Q}`),Y(`async call #${Q}`)}return W.emit(Me(m.baseInfo.id),{type:$,payload:J}),X?.promise},this._callUserModel=async($,J)=>{try{m[$](J)}catch{Y(`[model method] #${$} not existed`)}},setInterval(()=>{if(u.size>100)for(const[$,J]of u)J.settled&&u.delete($)},18e5)}).finally(()=>{this._status=void 0}),await p.promise,m.baseInfo}async call(e,n={}){var r;return(r=this._call)===null||r===void 0?void 0:r.call(this,e,n)}async callAsync(e,n={}){var r;const a=R(1e4);return(r=this._call)===null||r===void 0?void 0:r.call(this,e,n,a)}async callUserModel(e,...n){var r;return(r=this._callUserModel)===null||r===void 0?void 0:r.apply(this,[e,...n])}async callUserModelAsync(e,...n){var r;return e=`${ae}${e}`,(r=this._callUserModel)===null||r===void 0?void 0:r.apply(this,[e,...n])}async _setupIframeSandbox(){const e=this._pluginLocal,n=e.id,r=`${n}_lsp_main`,a=new URL(e.options.entry);a.searchParams.set("__v__",e.options.version);const u=document.querySelector(`#${r}`);u&&u.parentElement.removeChild(u);const p=document.createElement("div");p.classList.add("lsp-iframe-sandbox-container"),p.id=r,p.dataset.pid=n;try{var m;const $=(m=await this._pluginLocal._loadLayoutsData())===null||m===void 0?void 0:m.$$0;if($){p.dataset.inited_layout="true";let{width:J,height:X,left:Q,top:oe,vw:ce,vh:we}=$;Q=Math.max(Q,0),Q=typeof ce=="number"?`${Math.min(100*Q/ce,99)}%`:`${Q}px`,oe=Math.max(oe,45),oe=typeof we=="number"?`${Math.min(100*oe/we,99)}%`:`${oe}px`,Object.assign(p.style,{width:J+"px",height:X+"px",left:Q,top:oe})}}catch($){console.error("[Restore Layout Error]",$)}document.body.appendChild(p);const j=new _e({id:n+"_iframe",container:p,url:a.href,classListArray:["lsp-iframe-sandbox"],model:{baseInfo:JSON.parse(JSON.stringify(e.toJSON()))}});let U,W=j.sendHandshake();return this._status="pending",new Promise(($,J)=>{U=setTimeout(()=>{J(new Error("handshake Timeout")),j.destroy()},4e3),W.then(X=>{this._parent=X,this._connected=!0,this.emit("connected"),X.on(Me(e.id),({type:Q,payload:oe})=>{var ce,we;Y("[user -> *host] ",Q,oe),(ce=this._pluginLocal)===null||ce===void 0||ce.emit(Q,oe||{}),(we=this._pluginLocal)===null||we===void 0||we.caller.emit(Q,oe||{})}),this._call=async(...Q)=>{await X.call(Me(e.id),{type:Q[0],payload:Object.assign(Q[1]||{},{$$pid:e.id})})},this._callUserModel=async(Q,...oe)=>{if(Q.startsWith(ae))return await X.get(Q.replace(ae,""),...oe);X.call(Q,oe?.[0])},$(null)}).catch(X=>{J(X)}).finally(()=>{clearTimeout(U)})}).catch($=>{throw Y("[iframe sandbox] error",$),$}).finally(()=>{this._status=void 0})}async _setupShadowSandbox(){const e=this._pluginLocal,n=this._shadow=new Ee(e);try{this._status="pending",await n.load(),this._connected=!0,this.emit("connected"),this._call=async(r,a={},u)=>{var p;return u&&(a.actor=u),(p=this._pluginLocal)===null||p===void 0||p.emit(r,Object.assign(a,{$$pid:e.id})),u?.promise},this._callUserModel=async(...r)=>{var a;let u=r[0];(a=u)!==null&&a!==void 0&&a.startsWith(ae)&&(u=u.replace(ae,""));const p=r[1]||{},m=this._userModel[u];typeof m=="function"&&await m.call(null,p)}}catch(r){throw Y("[shadow sandbox] error",r),r}finally{this._status=void 0}}_extendUserModel(e){return Object.assign(this._userModel,e)}_getSandboxIframeContainer(){var e;return(e=this._parent)===null||e===void 0?void 0:e.frame.parentNode}_getSandboxShadowContainer(){var e;return(e=this._shadow)===null||e===void 0?void 0:e.frame.parentNode}_getSandboxIframeRoot(){var e;return(e=this._parent)===null||e===void 0?void 0:e.frame}_getSandboxShadowRoot(){var e;return(e=this._shadow)===null||e===void 0?void 0:e.frame}set debugTag(e){this._debugTag=e}async destroy(){var e;let n=null;this._parent&&(n=this._getSandboxIframeContainer(),await this._parent.destroy()),this._shadow&&(n=this._getSandboxShadowContainer(),this._shadow.destroy()),(e=n)===null||e===void 0||e.parentNode.removeChild(n)}}function fe(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class ue{constructor(e,n){fe(this,"ctx",void 0),fe(this,"opts",void 0),this.ctx=e,this.opts=n}get ctxId(){return this.ctx.baseInfo.id}setItem(e,n){var r;return this.ctx.caller.callAsync("api:call",{method:"write-plugin-storage-file",args:[this.ctxId,e,n,(r=this.opts)===null||r===void 0?void 0:r.assets]})}getItem(e){var n;return this.ctx.caller.callAsync("api:call",{method:"read-plugin-storage-file",args:[this.ctxId,e,(n=this.opts)===null||n===void 0?void 0:n.assets]})}removeItem(e){var n;return this.ctx.caller.call("api:call",{method:"unlink-plugin-storage-file",args:[this.ctxId,e,(n=this.opts)===null||n===void 0?void 0:n.assets]})}allKeys(){var e;return this.ctx.caller.callAsync("api:call",{method:"list-plugin-storage-files",args:[this.ctxId,(e=this.opts)===null||e===void 0?void 0:e.assets]})}clear(){var e;return this.ctx.caller.call("api:call",{method:"clear-plugin-storage-files",args:[this.ctxId,(e=this.opts)===null||e===void 0?void 0:e.assets]})}hasItem(e){var n;return this.ctx.caller.callAsync("api:call",{method:"exist-plugin-storage-file",args:[this.ctxId,e,(n=this.opts)===null||n===void 0?void 0:n.assets]})}}class Oe{constructor(e){var n,r,a;a=void 0,(r="ctx")in(n=this)?Object.defineProperty(n,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[r]=a,this.ctx=e}get React(){return this.ensureHostScope().React}get ReactDOM(){return this.ensureHostScope().ReactDOM}get pluginLocal(){return this.ensureHostScope().LSPluginCore.ensurePlugin(this.ctx.baseInfo.id)}invokeExperMethod(e,...n){var r,a;const u=this.ensureHostScope();return e=(r=M(e))===null||r===void 0?void 0:r.toLowerCase(),(a=u.logseq.api["exper_"+e])===null||a===void 0?void 0:a.apply(u,n)}async loadScripts(...e){(e=e.map(n=>n!=null&&n.startsWith("http")?n:this.ctx.resolveResourceFullUrl(n))).unshift(this.ctx.baseInfo.id),await this.invokeExperMethod("loadScripts",...e)}registerFencedCodeRenderer(e,n){return this.ensureHostScope().logseq.api.exper_register_fenced_code_renderer(this.ctx.baseInfo.id,e,n)}registerExtensionsEnhancer(e,n){const r=this.ensureHostScope();return e==="katex"&&r.katex&&n(r.katex).catch(console.error),r.logseq.api.exper_register_extensions_enhancer(this.ctx.baseInfo.id,e,n)}ensureHostScope(){if(window===top)throw new Error("Can not access host scope!");return top}}function Le(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const qe=t=>`task_callback_${t}`;class Ke{constructor(e,n,r={}){Le(this,"_client",void 0),Le(this,"_requestId",void 0),Le(this,"_requestOptions",void 0),Le(this,"_promise",void 0),Le(this,"_aborted",!1),this._client=e,this._requestId=n,this._requestOptions=r,this._promise=new Promise((m,j)=>{if(!this._requestId)return j(null);this._client.once(qe(this._requestId),U=>{U&&U instanceof Error?j(U):m(U)})});const{success:a,fail:u,final:p}=this._requestOptions;this._promise.then(m=>{a?.(m)}).catch(m=>{u?.(m)}).finally(()=>{p?.()})}abort(){this._requestOptions.abortable&&!this._aborted&&(this._client.ctx._execCallableAPI("http_request_abort",this._requestId),this._aborted=!0)}get promise(){return this._promise}get client(){return this._client}get requestId(){return this._requestId}}class Fe extends k.EventEmitter{constructor(e){super(),Le(this,"_ctx",void 0),this._ctx=e,this.ctx.caller.on("#lsp#request#callback",n=>{const r=n?.requestId;r&&this.emit(qe(r),n?.payload)})}static createRequestTask(e,n,r){return new Ke(e,n,r)}async _request(e){const n=this.ctx.baseInfo.id,{success:r,fail:a,final:u,...p}=e,m=this.ctx.Experiments.invokeExperMethod("request",n,p),j=Fe.createRequestTask(this.ctx.Request,m,e);return p.abortable?j:j.promise}get ctx(){return this._ctx}}const Ie=Array.isArray,gt=typeof An=="object"&&An&&An.Object===Object&&An;var Rn=typeof self=="object"&&self&&self.Object===Object&&self;const $e=gt||Rn||Function("return this")(),Je=$e.Symbol;var an=Object.prototype,Nn=an.hasOwnProperty,qn=an.toString,mt=Je?Je.toStringTag:void 0;const $n=function(t){var e=Nn.call(t,mt),n=t[mt];try{t[mt]=void 0;var r=!0}catch{}var a=qn.call(t);return r&&(e?t[mt]=n:delete t[mt]),a};var sn=Object.prototype.toString;const E=function(t){return sn.call(t)};var N=Je?Je.toStringTag:void 0;const G=function(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":N&&N in Object(t)?$n(t):E(t)},Z=function(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")},me=function(t){if(!Z(t))return!1;var e=G(t);return e=="[object Function]"||e=="[object GeneratorFunction]"||e=="[object AsyncFunction]"||e=="[object Proxy]"},He=$e["__core-js_shared__"];var Ve,it=(Ve=/[^.]+$/.exec(He&&He.keys&&He.keys.IE_PROTO||""))?"Symbol(src)_1."+Ve:"";const Dt=function(t){return!!it&&it in t};var ln=Function.prototype.toString;const Xe=function(t){if(t!=null){try{return ln.call(t)}catch{}try{return t+""}catch{}}return""};var Hn=/^\[object .+?Constructor\]$/,Un=Function.prototype,Dn=Object.prototype,At=Un.toString,zn=Dn.hasOwnProperty,Bn=RegExp("^"+At.call(zn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Wn=function(t){return!(!Z(t)||Dt(t))&&(me(t)?Bn:Hn).test(Xe(t))},zt=function(t,e){return t?.[e]},Ue=function(t,e){var n=zt(t,e);return Wn(n)?n:void 0},De=function(){try{var t=Ue(Object,"defineProperty");return t({},"",{}),t}catch{}}(),cn=function(t,e,n){e=="__proto__"&&De?De(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n},Lt=function(t){return function(e,n,r){for(var a=-1,u=Object(e),p=r(e),m=p.length;m--;){var j=p[t?m:++a];if(n(u[j],j,u)===!1)break}return e}}(),Bt=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r},ot=function(t){return t!=null&&typeof t=="object"},un=function(t){return ot(t)&&G(t)=="[object Arguments]"};var dn=Object.prototype,Gn=dn.hasOwnProperty,pn=dn.propertyIsEnumerable;const Re=un(function(){return arguments}())?un:function(t){return ot(t)&&Gn.call(t,"callee")&&!pn.call(t,"callee")},vt=function(){return!1};var Qe=s&&!s.nodeType&&s,It=Qe&&!0&&l&&!l.nodeType&&l,Pt=It&&It.exports===Qe?$e.Buffer:void 0;const Wt=(Pt?Pt.isBuffer:void 0)||vt;var Jn=/^(?:0|[1-9]\d*)$/;const fn=function(t,e){var n=typeof t;return!!(e=e??9007199254740991)&&(n=="number"||n!="symbol"&&Jn.test(t))&&t>-1&&t%1==0&&t<e},Mt=function(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=9007199254740991};var re={};re["[object Float32Array]"]=re["[object Float64Array]"]=re["[object Int8Array]"]=re["[object Int16Array]"]=re["[object Int32Array]"]=re["[object Uint8Array]"]=re["[object Uint8ClampedArray]"]=re["[object Uint16Array]"]=re["[object Uint32Array]"]=!0,re["[object Arguments]"]=re["[object Array]"]=re["[object ArrayBuffer]"]=re["[object Boolean]"]=re["[object DataView]"]=re["[object Date]"]=re["[object Error]"]=re["[object Function]"]=re["[object Map]"]=re["[object Number]"]=re["[object Object]"]=re["[object RegExp]"]=re["[object Set]"]=re["[object String]"]=re["[object WeakMap]"]=!1;const ve=function(t){return ot(t)&&Mt(t.length)&&!!re[G(t)]},hn=function(t){return function(e){return t(e)}};var ye=s&&!s.nodeType&&s,at=ye&&!0&&l&&!l.nodeType&&l,de=at&&at.exports===ye&&gt.process,st=function(){try{var t=at&&at.require&&at.require("util").types;return t||de&&de.binding&&de.binding("util")}catch{}}(),Ft=st&&st.isTypedArray;const Gt=Ft?hn(Ft):ve;var Jt=Object.prototype.hasOwnProperty;const gn=function(t,e){var n=Ie(t),r=!n&&Re(t),a=!n&&!r&&Wt(t),u=!n&&!r&&!a&&Gt(t),p=n||r||a||u,m=p?Bt(t.length,String):[],j=m.length;for(var U in t)!e&&!Jt.call(t,U)||p&&(U=="length"||a&&(U=="offset"||U=="parent")||u&&(U=="buffer"||U=="byteLength"||U=="byteOffset")||fn(U,j))||m.push(U);return m};var lt=Object.prototype;const et=function(t){var e=t&&t.constructor;return t===(typeof e=="function"&&e.prototype||lt)},Vt=function(t,e){return function(n){return t(e(n))}}(Object.keys,Object);var Qt=Object.prototype.hasOwnProperty;const ct=function(t){if(!et(t))return Vt(t);var e=[];for(var n in Object(t))Qt.call(t,n)&&n!="constructor"&&e.push(n);return e},Rt=function(t){return t!=null&&Mt(t.length)&&!me(t)},ut=function(t){return Rt(t)?gn(t):ct(t)},mn=function(t,e){return t&&Lt(t,e,ut)},Yt=function(){this.__data__=[],this.size=0},dt=function(t,e){return t===e||t!=t&&e!=e},ze=function(t,e){for(var n=t.length;n--;)if(dt(t[n][0],e))return n;return-1};var pt=Array.prototype.splice;const vn=function(t){var e=this.__data__,n=ze(e,t);return!(n<0)&&(n==e.length-1?e.pop():pt.call(e,n,1),--this.size,!0)},yn=function(t){var e=this.__data__,n=ze(e,t);return n<0?void 0:e[n][1]},bn=function(t){return ze(this.__data__,t)>-1},Zt=function(t,e){var n=this.__data__,r=ze(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};function tt(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}tt.prototype.clear=Yt,tt.prototype.delete=vn,tt.prototype.get=yn,tt.prototype.has=bn,tt.prototype.set=Zt;const ft=tt,Kt=function(){this.__data__=new ft,this.size=0},Ye=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Nt=function(t){return this.__data__.get(t)},wn=function(t){return this.__data__.has(t)},yt=Ue($e,"Map"),bt=Ue(Object,"create"),ht=function(){this.__data__=bt?bt(null):{},this.size=0},Vn=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e};var _n=Object.prototype.hasOwnProperty;const Xt=function(t){var e=this.__data__;if(bt){var n=e[t];return n==="__lodash_hash_undefined__"?void 0:n}return _n.call(e,t)?e[t]:void 0};var xn=Object.prototype.hasOwnProperty;const kn=function(t){var e=this.__data__;return bt?e[t]!==void 0:xn.call(e,t)},Qn=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=bt&&e===void 0?"__lodash_hash_undefined__":e,this};function Be(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Be.prototype.clear=ht,Be.prototype.delete=Vn,Be.prototype.get=Xt,Be.prototype.has=kn,Be.prototype.set=Qn;const qt=Be,Yn=function(){this.size=0,this.__data__={hash:new qt,map:new(yt||ft),string:new qt}},We=function(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null},wt=function(t,e){var n=t.__data__;return We(e)?n[typeof e=="string"?"string":"hash"]:n.map},Sn=function(t){var e=wt(this,t).delete(t);return this.size-=e?1:0,e},Cn=function(t){return wt(this,t).get(t)},Zn=function(t){return wt(this,t).has(t)},_t=function(t,e){var n=wt(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function Te(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Te.prototype.clear=Yn,Te.prototype.delete=Sn,Te.prototype.get=Cn,Te.prototype.has=Zn,Te.prototype.set=_t;const xt=Te,En=function(t,e){var n=this.__data__;if(n instanceof ft){var r=n.__data__;if(!yt||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new xt(r)}return n.set(t,e),this.size=n.size,this};function nt(t){var e=this.__data__=new ft(t);this.size=e.size}nt.prototype.clear=Kt,nt.prototype.delete=Ye,nt.prototype.get=Nt,nt.prototype.has=wn,nt.prototype.set=En;const kt=nt,Kn=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},i=function(t){return this.__data__.has(t)};function L(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new xt;++e<n;)this.add(t[e])}L.prototype.add=L.prototype.push=Kn,L.prototype.has=i;const C=L,ie=function(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1},he=function(t,e){return t.has(e)},xe=function(t,e,n,r,a,u){var p=1&n,m=t.length,j=e.length;if(m!=j&&!(p&&j>m))return!1;var U=u.get(t),W=u.get(e);if(U&&W)return U==e&&W==t;var $=-1,J=!0,X=2&n?new C:void 0;for(u.set(t,e),u.set(e,t);++$<m;){var Q=t[$],oe=e[$];if(r)var ce=p?r(oe,Q,$,e,t,u):r(Q,oe,$,t,e,u);if(ce!==void 0){if(ce)continue;J=!1;break}if(X){if(!ie(e,function(we,Ne){if(!he(X,Ne)&&(Q===we||a(Q,we,n,r,u)))return X.push(Ne)})){J=!1;break}}else if(Q!==oe&&!a(Q,oe,n,r,u)){J=!1;break}}return u.delete(t),u.delete(e),J},be=$e.Uint8Array,St=function(t){var e=-1,n=Array(t.size);return t.forEach(function(r,a){n[++e]=[a,r]}),n},Ze=function(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n};var Pe=Je?Je.prototype:void 0,en=Pe?Pe.valueOf:void 0;const hr=function(t,e,n,r,a,u,p){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!u(new be(t),new be(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return dt(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var m=St;case"[object Set]":var j=1&r;if(m||(m=Ze),t.size!=e.size&&!j)return!1;var U=p.get(t);if(U)return U==e;r|=2,p.set(t,e);var W=xe(m(t),m(e),r,a,u,p);return p.delete(t),W;case"[object Symbol]":if(en)return en.call(t)==en.call(e)}return!1},ei=function(t,e){for(var n=-1,r=e.length,a=t.length;++n<r;)t[a+n]=e[n];return t},ti=function(t,e,n){var r=e(t);return Ie(t)?r:ei(r,n(t))},ni=function(t,e){for(var n=-1,r=t==null?0:t.length,a=0,u=[];++n<r;){var p=t[n];e(p,n,t)&&(u[a++]=p)}return u},ri=function(){return[]};var ii=Object.prototype.propertyIsEnumerable,gr=Object.getOwnPropertySymbols;const oi=gr?function(t){return t==null?[]:(t=Object(t),ni(gr(t),function(e){return ii.call(t,e)}))}:ri,mr=function(t){return ti(t,ut,oi)};var ai=Object.prototype.hasOwnProperty;const si=function(t,e,n,r,a,u){var p=1&n,m=mr(t),j=m.length;if(j!=mr(e).length&&!p)return!1;for(var U=j;U--;){var W=m[U];if(!(p?W in e:ai.call(e,W)))return!1}var $=u.get(t),J=u.get(e);if($&&J)return $==e&&J==t;var X=!0;u.set(t,e),u.set(e,t);for(var Q=p;++U<j;){var oe=t[W=m[U]],ce=e[W];if(r)var we=p?r(ce,oe,W,e,t,u):r(oe,ce,W,t,e,u);if(!(we===void 0?oe===ce||a(oe,ce,n,r,u):we)){X=!1;break}Q||(Q=W=="constructor")}if(X&&!Q){var Ne=t.constructor,Et=e.constructor;Ne==Et||!("constructor"in t)||!("constructor"in e)||typeof Ne=="function"&&Ne instanceof Ne&&typeof Et=="function"&&Et instanceof Et||(X=!1)}return u.delete(t),u.delete(e),X},Xn=Ue($e,"DataView"),er=Ue($e,"Promise"),tr=Ue($e,"Set"),nr=Ue($e,"WeakMap");var vr="[object Map]",yr="[object Promise]",br="[object Set]",wr="[object WeakMap]",_r="[object DataView]",li=Xe(Xn),ci=Xe(yt),ui=Xe(er),di=Xe(tr),pi=Xe(nr),Ct=G;(Xn&&Ct(new Xn(new ArrayBuffer(1)))!=_r||yt&&Ct(new yt)!=vr||er&&Ct(er.resolve())!=yr||tr&&Ct(new tr)!=br||nr&&Ct(new nr)!=wr)&&(Ct=function(t){var e=G(t),n=e=="[object Object]"?t.constructor:void 0,r=n?Xe(n):"";if(r)switch(r){case li:return _r;case ci:return vr;case ui:return yr;case di:return br;case pi:return wr}return e});const xr=Ct;var kr="[object Arguments]",Sr="[object Array]",On="[object Object]",Cr=Object.prototype.hasOwnProperty;const fi=function(t,e,n,r,a,u){var p=Ie(t),m=Ie(e),j=p?Sr:xr(t),U=m?Sr:xr(e),W=(j=j==kr?On:j)==On,$=(U=U==kr?On:U)==On,J=j==U;if(J&&Wt(t)){if(!Wt(e))return!1;p=!0,W=!1}if(J&&!W)return u||(u=new kt),p||Gt(t)?xe(t,e,n,r,a,u):hr(t,e,j,n,r,a,u);if(!(1&n)){var X=W&&Cr.call(t,"__wrapped__"),Q=$&&Cr.call(e,"__wrapped__");if(X||Q){var oe=X?t.value():t,ce=Q?e.value():e;return u||(u=new kt),a(oe,ce,n,r,u)}}return!!J&&(u||(u=new kt),si(t,e,n,r,a,u))},Er=function t(e,n,r,a,u){return e===n||(e==null||n==null||!ot(e)&&!ot(n)?e!=e&&n!=n:fi(e,n,r,a,t,u))},hi=function(t,e,n,r){var a=n.length,u=a,p=!r;if(t==null)return!u;for(t=Object(t);a--;){var m=n[a];if(p&&m[2]?m[1]!==t[m[0]]:!(m[0]in t))return!1}for(;++a<u;){var j=(m=n[a])[0],U=t[j],W=m[1];if(p&&m[2]){if(U===void 0&&!(j in t))return!1}else{var $=new kt;if(r)var J=r(U,W,j,t,e,$);if(!(J===void 0?Er(W,U,3,r,$):J))return!1}}return!0},Or=function(t){return t==t&&!Z(t)},gi=function(t){for(var e=ut(t),n=e.length;n--;){var r=e[n],a=t[r];e[n]=[r,a,Or(a)]}return e},Tr=function(t,e){return function(n){return n!=null&&n[t]===e&&(e!==void 0||t in Object(n))}},mi=function(t){var e=gi(t);return e.length==1&&e[0][2]?Tr(e[0][0],e[0][1]):function(n){return n===t||hi(n,t,e)}},rr=function(t){return typeof t=="symbol"||ot(t)&&G(t)=="[object Symbol]"};var vi=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,yi=/^\w*$/;const ir=function(t,e){if(Ie(t))return!1;var n=typeof t;return!(n!="number"&&n!="symbol"&&n!="boolean"&&t!=null&&!rr(t))||yi.test(t)||!vi.test(t)||e!=null&&t in Object(e)};function or(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError("Expected a function");var n=function(){var r=arguments,a=e?e.apply(this,r):r[0],u=n.cache;if(u.has(a))return u.get(a);var p=t.apply(this,r);return n.cache=u.set(a,p)||u,p};return n.cache=new(or.Cache||xt),n}or.Cache=xt;const bi=or;var wi=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,_i=/\\(\\)?/g;const xi=function(t){var e=bi(t,function(r){return n.size===500&&n.clear(),r}),n=e.cache;return e}(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(wi,function(n,r,a,u){e.push(a?u.replace(_i,"$1"):r||n)}),e}),ki=function(t,e){for(var n=-1,r=t==null?0:t.length,a=Array(r);++n<r;)a[n]=e(t[n],n,t);return a};var jr=Je?Je.prototype:void 0,Ar=jr?jr.toString:void 0;const Si=function t(e){if(typeof e=="string")return e;if(Ie(e))return ki(e,t)+"";if(rr(e))return Ar?Ar.call(e):"";var n=e+"";return n=="0"&&1/e==-1/0?"-0":n},Ci=function(t){return t==null?"":Si(t)},Lr=function(t,e){return Ie(t)?t:ir(t,e)?[t]:xi(Ci(t))},Tn=function(t){if(typeof t=="string"||rr(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e},Ir=function(t,e){for(var n=0,r=(e=Lr(e,t)).length;t!=null&&n<r;)t=t[Tn(e[n++])];return n&&n==r?t:void 0},Ei=function(t,e,n){var r=t==null?void 0:Ir(t,e);return r===void 0?n:r},Oi=function(t,e){return t!=null&&e in Object(t)},Ti=function(t,e,n){for(var r=-1,a=(e=Lr(e,t)).length,u=!1;++r<a;){var p=Tn(e[r]);if(!(u=t!=null&&n(t,p)))break;t=t[p]}return u||++r!=a?u:!!(a=t==null?0:t.length)&&Mt(a)&&fn(p,a)&&(Ie(t)||Re(t))},ji=function(t,e){return t!=null&&Ti(t,e,Oi)},Ai=function(t,e){return ir(t)&&Or(e)?Tr(Tn(t),e):function(n){var r=Ei(n,t);return r===void 0&&r===e?ji(n,t):Er(e,r,3)}},Li=function(t){return t},Ii=function(t){return function(e){return e?.[t]}},Pi=function(t){return function(e){return Ir(e,t)}},Mi=function(t){return ir(t)?Ii(Tn(t)):Pi(t)},Fi=function(t){return typeof t=="function"?t:t==null?Li:typeof t=="object"?Ie(t)?Ai(t[0],t[1]):mi(t):Mi(t)},Ri=function(t,e){var n={};return e=Fi(e),mn(t,function(r,a,u){cn(n,e(r,a,u),r)}),n};function Pr(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class Ni{constructor(e,n){Pr(this,"ctx",void 0),Pr(this,"serviceHooks",void 0),this.ctx=e,this.serviceHooks=n,e._execCallableAPI("register-search-service",e.baseInfo.id,n.name,n.options),Object.entries({query:{f:"onQuery",args:["graph","q",!0],reply:!0,transformOutput:r=>(Ie(r?.blocks)&&(r.blocks=r.blocks.map(a=>a&&Ri(a,(u,p)=>`block/${p}`))),r)},rebuildBlocksIndice:{f:"onIndiceInit",args:["graph","blocks"]},transactBlocks:{f:"onBlocksChanged",args:["graph","data"]},truncateBlocks:{f:"onIndiceReset",args:["graph"]},removeDb:{f:"onGraph",args:["graph"]}}).forEach(([r,a])=>{const u=(p=>`service:search:${p}:${n.name}`)(r);e.caller.on(u,async p=>{if(me(n?.[a.f])){let m=null;try{m=await n[a.f].apply(n,(a.args||[]).map(j=>{if(p){if(j===!0)return p;if(p.hasOwnProperty(j)){const U=p[j];return delete p[j],U}}})),a.transformOutput&&(m=a.transformOutput(m))}catch(j){console.error("[SearchService] ",j),m=j}finally{a.reply&&e.caller.call(`${u}:reply`,m)}}})})}}function Ge(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const qi=Symbol.for("proxy-continue"),$i=y()("LSPlugin:user"),Mr=new z("",{console:!0});function $t(t,e,n){var r;const{key:a,label:u,desc:p,palette:m,keybinding:j,extras:U}=e;if(typeof n!="function")return this.logger.error(`${a||u}: command action should be function.`),!1;const W=function(J){if(typeof J=="string")return J.trim().replace(/\s/g,"_").toLowerCase()}(a);if(!W)return this.logger.error(`${u}: command key is required.`),!1;const $=`SimpleCommandHook${W}${++Nr}`;this.Editor["on"+$](n),(r=this.caller)===null||r===void 0||r.call("api:call",{method:"register-plugin-simple-command",args:[this.baseInfo.id,[{key:W,label:u,type:t,desc:p,keybinding:j,extras:U},["editor/hook",$]],m]})}function Fr(t){return!(typeof(e=t)!="string"||e.length!==36||!/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/gi.test(e))||(Mr.error(`#${t} is not a valid UUID string.`),!1);var e}let jn=null,Rr=new Map;const Hi={async getInfo(t){return jn||(jn=await this._execCallableAPIAsync("get-app-info")),typeof t=="string"?jn[t]:jn},registerCommand:$t,registerSearchService(t){if(Rr.has(t.name))throw new Error(`SearchService: #${t.name} has registered!`);Rr.set(t.name,new Ni(this,t))},registerCommandPalette(t,e){const{key:n,label:r,keybinding:a}=t;return $t.call(this,"$palette$",{key:n,label:r,palette:!0,keybinding:a},e)},registerCommandShortcut(t,e,n={}){typeof t=="string"&&(t={mode:"global",binding:t});const{binding:r}=t,a="$shortcut$",u=n.key||a+M(r?.toString());return $t.call(this,a,{...n,key:u,palette:!1,keybinding:t},e)},registerUIItem(t,e){var n;const r=this.baseInfo.id;(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-ui-item",args:[r,t,e]})},registerPageMenuItem(t,e){if(typeof e!="function")return!1;const n=t+"_"+this.baseInfo.id,r=t;$t.call(this,"page-menu-item",{key:n,label:r},e)},onBlockRendererSlotted(t,e){if(!Fr(t))return;const n=this.baseInfo.id,r=`hook:editor:${M(`slot:${t}`)}`;return this.caller.on(r,e),this.App._installPluginHook(n,r),()=>{this.caller.off(r,e),this.App._uninstallPluginHook(n,r)}},invokeExternalPlugin(t,...e){var n;if(!(t=(n=t)===null||n===void 0?void 0:n.trim()))return;let[r,a]=t.split(".");if(!["models","commands"].includes(a?.toLowerCase()))throw new Error("Type only support '.models' or '.commands' currently.");const u=t.replace(`${r}.${a}.`,"");if(!r||!a||!u)throw new Error(`Illegal type of #${t} to invoke external plugin.`);return this._execCallableAPIAsync("invoke_external_plugin_cmd",r,a.toLowerCase(),u,e)},setFullScreen(t){const e=(...n)=>this._callWin("setFullScreen",...n);t==="toggle"?this._callWin("isFullScreen").then(n=>{n?e():e(!0)}):t?e(!0):e()}};let Nr=0;const Ui={newBlockUUID(){return this._execCallableAPIAsync("new_block_uuid")},registerSlashCommand(t,e){var n;$i("Register slash command #",this.baseInfo.id,t,e),typeof e=="function"&&(e=[["editor/clear-current-slash",!1],["editor/restore-saved-cursor"],["editor/hook",e]]),e=e.map(r=>{const[a,...u]=r;if(a==="editor/hook"){let p=u[0],m=()=>{var U;(U=this.caller)===null||U===void 0||U.callUserModel(p)};typeof p=="function"&&(m=p);const j=`SlashCommandHook${a}${++Nr}`;r[1]=j,this.Editor["on"+j](m)}return r}),(n=this.caller)===null||n===void 0||n.call("api:call",{method:"register-plugin-slash-command",args:[this.baseInfo.id,[t,e]]})},registerBlockContextMenuItem(t,e){if(typeof e!="function")return!1;const n=t+"_"+this.baseInfo.id;$t.call(this,"block-context-menu-item",{key:n,label:t},e)},registerHighlightContextMenuItem(t,e,n){if(typeof e!="function")return!1;const r=t+"_"+this.baseInfo.id;$t.call(this,"highlight-context-menu-item",{key:r,label:t,extras:n},e)},scrollToBlockInPage(t,e,n){const r="block-content-"+e;n!=null&&n.replaceState?this.App.replaceState("page",{name:t},{anchor:r}):this.App.pushState("page",{name:t},{anchor:r})}},Di={onBlockChanged(t,e){if(!Fr(t))return;const n=this.baseInfo.id,r=`hook:db:${M(`block:${t}`)}`,a=({block:u,txData:p,txMeta:m})=>{u.uuid===t&&e(u,p,m)};return this.caller.on(r,a),this.App._installPluginHook(n,r),()=>{this.caller.off(r,a),this.App._uninstallPluginHook(n,r)}},datascriptQuery(t,...e){return e.pop(),e!=null&&e.some(n=>typeof n=="function")?this.Experiments.ensureHostScope().logseq.api.datascript_query(t,...e):this._execCallableAPIAsync("datascript_query",t,...e)}},zi={},Bi={},Wi={makeSandboxStorage(){return new ue(this,{assets:!0})}};class ar extends f(){constructor(e,n){super(),Ge(this,"_baseInfo",void 0),Ge(this,"_caller",void 0),Ge(this,"_version","0.0.17"),Ge(this,"_debugTag",""),Ge(this,"_settingsSchema",void 0),Ge(this,"_connected",!1),Ge(this,"_ui",new Map),Ge(this,"_mFileStorage",void 0),Ge(this,"_mRequest",void 0),Ge(this,"_mExperiments",void 0),Ge(this,"_beforeunloadCallback",void 0),this._baseInfo=e,this._caller=n,n.on("sys:ui:visible",r=>{r!=null&&r.toggle&&this.toggleMainUI()}),n.on("settings:changed",r=>{const a=Object.assign({},this.settings),u=Object.assign(this._baseInfo.settings,r);this.emit("settings:changed",{...u},a)}),n.on("beforeunload",async r=>{const{actor:a,...u}=r,p=this._beforeunloadCallback;try{p&&await p(u),a?.resolve(null)}catch(m){this.logger.error("[beforeunload] ",m),a?.reject(m)}})}async ready(e,n){var r,a;if(!this._connected)try{var u;typeof e=="function"&&(n=e,e={});let p=await this._caller.connectToParent(e);this._connected=!0,r=this._baseInfo,a=p,p=O()(r,a,{arrayMerge:(m,j)=>j}),this._baseInfo=p,(u=p)!==null&&u!==void 0&&u.id&&(this._debugTag=this._caller.debugTag=`#${p.id} [${p.name}]`,this.logger.setTag(this._debugTag)),this._settingsSchema&&(p.settings=function(m,j){const U=(j||[]).reduce((W,$)=>("default"in $&&(W[$.key]=$.default),W),{});return Object.assign(U,m)}(p.settings,this._settingsSchema),await this.useSettingsSchema(this._settingsSchema));try{await this._execCallableAPIAsync("setSDKMetadata",{version:this._version})}catch(m){console.warn(m)}n&&n.call(this,p)}catch(p){console.error(`${this._debugTag} [Ready Error]`,p)}}ensureConnected(){if(!this._connected)throw new Error("not connected")}beforeunload(e){typeof e=="function"&&(this._beforeunloadCallback=e)}provideModel(e){return this.caller._extendUserModel(e),this}provideTheme(e){return this.caller.call("provider:theme",e),this}provideStyle(e){return this.caller.call("provider:style",e),this}provideUI(e){return this.caller.call("provider:ui",e),this}useSettingsSchema(e){return this.connected&&this.caller.call("settings:schema",{schema:e,isSync:!0}),this._settingsSchema=e,this}updateSettings(e){this.caller.call("settings:update",e)}onSettingsChanged(e){const n="settings:changed";return this.on(n,e),()=>this.off(n,e)}showSettingsUI(){this.caller.call("settings:visible:changed",{visible:!0})}hideSettingsUI(){this.caller.call("settings:visible:changed",{visible:!1})}setMainUIAttrs(e){this.caller.call("main-ui:attrs",e)}setMainUIInlineStyle(e){this.caller.call("main-ui:style",e)}hideMainUI(e){const n={key:0,visible:!1,cursor:e?.restoreEditingCursor};this.caller.call("main-ui:visible",n),this.emit("ui:visible:changed",n),this._ui.set(n.key,n)}showMainUI(e){const n={key:0,visible:!0,autoFocus:e?.autoFocus};this.caller.call("main-ui:visible",n),this.emit("ui:visible:changed",n),this._ui.set(n.key,n)}toggleMainUI(){const n=this._ui.get(0);n&&n.visible?this.hideMainUI():this.showMainUI()}get version(){return this._version}get isMainUIVisible(){const e=this._ui.get(0);return!!(e&&e.visible)}get connected(){return this._connected}get baseInfo(){return this._baseInfo}get effect(){return(e=this)&&(((n=e.baseInfo)===null||n===void 0?void 0:n.effect)||!((r=e.baseInfo)!==null&&r!==void 0&&r.iir));var e,n,r}get logger(){return Mr}get settings(){var e;return(e=this.baseInfo)===null||e===void 0?void 0:e.settings}get caller(){return this._caller}resolveResourceFullUrl(e){if(this.ensureConnected(),e)return e=e.replace(/^[.\\/]+/,""),P(this._baseInfo.lsr,e)}_makeUserProxy(e,n){const r=this,a=this.caller;return new Proxy(e,{get(u,p,m){const j=u[p];return function(...U){if(j){const $=j.apply(r,U.concat(n));if($!==qi)return $}if(n){const $=p.toString().match(/^(once|off|on)/i);if($!=null){const J=$[0].toLowerCase(),X=$.input,Q=J==="off",oe=r.baseInfo.id;let ce=X.slice(J.length),we=U[0],Ne=U[1];typeof we=="string"&&typeof Ne=="function"&&(we=we.replace(/^logseq./,":"),ce=`${ce}${we}`,we=Ne,Ne=U[2]),ce=`hook:${n}:${M(ce)}`,a[J](ce,we);const Et=()=>{a.off(ce,we),a.listenerCount(ce)||r.App._uninstallPluginHook(oe,ce)};return Q?void Et():(r.App._installPluginHook(oe,ce,Ne),Et)}}let W=p;return["git","ui","assets"].includes(n)&&(W=n+"_"+W),a.callAsync("api:call",{tag:n,method:W,args:U})}}})}_execCallableAPIAsync(e,...n){return this._caller.callAsync("api:call",{method:e,args:n})}_execCallableAPI(e,...n){this._caller.call("api:call",{method:e,args:n})}_callWin(...e){return this._execCallableAPIAsync("_callMainWin",...e)}get App(){return this._makeUserProxy(Hi,"app")}get Editor(){return this._makeUserProxy(Ui,"editor")}get DB(){return this._makeUserProxy(Di,"db")}get Git(){return this._makeUserProxy(zi,"git")}get UI(){return this._makeUserProxy(Bi,"ui")}get Assets(){return this._makeUserProxy(Wi,"assets")}get FileStorage(){let e=this._mFileStorage;return e||(e=this._mFileStorage=new ue(this)),e}get Request(){let e=this._mRequest;return e||(e=this._mRequest=new Fe(this)),e}get Experiments(){let e=this._mExperiments;return e||(e=this._mExperiments=new Oe(this)),e}}function qr(t,e){return new ar(t,e)}if(window.__LSP__HOST__==null){const t=new rt(null);window.logseq=qr({},t)}})(),ee})())})(Mn,Mn.exports);Mn.exports;const Br="en";let In=Br,Wr={};async function Ji({defaultLocale:l=Br,builtinTranslations:s}){In=(await logseq.App.getUserConfigs()).preferredLanguage,In!==l&&s?.[In]!=null&&(Wr=s)}function le(l,s){const v=Wr[In]?.[l]??l;return s==null?v:Object.entries(s).reduce((D,[A,ee])=>D.replaceAll(`\${${A}}`,ee),v)}const Gr='body[data-page=page]:not(.is-pdf-active){@media screen and (max-width:699px){& div#main-content-container :is(div.page-hierarchy,div.references.page-tags){display:none}}@media screen and (min-width:700px){&:not(.is-tabs-loaded) main:not(.ls-right-sidebar-open) div#main-content-container div:is(.relative+div.references,.page-hierarchy){font-size:.91em;background-color:var(--ls-primary-background-color);outline-offset:2px;outline:2px solid var(--ls-table-tr-even-background-color);border-radius:10px;overflow:scroll;white-space:nowrap;position:fixed}& div#main-content-container{& div.flex-1.page.relative{margin-bottom:2em;margin-top:2em;margin-left:1.5em}& div.page-hierarchy,div.references.page-tags{@media screen and (max-height: 1300px){max-height:220px}@media screen and (min-height: 1301px){max-height:420px}border:2px solid var(--ls-border-color);box-shadow:0 0 7px var(--ls-border-color);padding:.9em;z-index:var(--ls-z-index-level-3);& div.foldable-title h2{cursor:pointer;opacity:.5;&:before{content:"▽";margin-right:.5em}}}& div.references.page-tags{bottom:0;right:.3em;width:23vw}& div.page-hierarchy{min-width:23vw;max-width:32vw;right:23.5vw;bottom:0}}& main.ls-wide-mode div#main-content-container div.cp__sidebar-main-content{max-width:1450px}& div#right-sidebar :is(div.page-hierarchy,div.references.page-tags),main.ls-right-sidebar-open div#main-content-container :is(div.page-hierarchy,div.references.page-tags){display:none}}}',Jr=l=>{const s=l.length,v=s===1?`&:has(span.page-reference[data-ref*="${l[0]}/"i]+span.mx-2)`:`&:has(span.page-reference[data-ref*="${l[s-1]}/"i]+span.mx-2)`;logseq.provideStyle({key:Xr,style:`
        body[data-page="page"]>div#root>div>main div.page.relative>div.page-hierarchy ul.namespaces>li.my-2 {
            ${v} {
                display: none;
            }
        }
        `})},Vi=l=>{let s="";for(let v=0;v<l.length;v++)s+=`&[data-ref="${l.slice(0,v+1).join("/")}"i]+span.mx-2,`;s=s.slice(0,-1),logseq.provideStyle({key:bo,style:`
        body[data-page="page"]>div#root>div>main div.page.relative>div.page-hierarchy ul.namespaces>li.my-2>span.page-reference {
            ${s} {
                display: none;
            }
        }
        `})},pe=l=>{const s=parent.document.head.querySelector(`style[data-injected-style^="${l}"]`);s&&s.remove()},$r=l=>{const s=parent.document.getElementsByClassName(l)[0];s&&s.remove()},Qi=l=>{const s=parent.document.getElementById(l);s&&s.remove()},sr=(l,s)=>{logseq.provideStyle({key:l,style:s})},Yi=(l,s)=>{!l||!s||(l.onclick=async()=>{s.classList.contains("initial")?(s.classList.remove("initial"),s.classList.add("hidden")):(s.classList.remove("hidden"),s.classList.add("initial"))})},Zi="body>div#root>div>main article>div[data-id=logseq-page-tags-and-hierarchy] div.heading-item{margin-top:3em;border-top-width:1px;padding-top:1em}body[data-page=page]>div#root>div>main div#main-content-container div.is-journals>div.relative div div.ls-page-title span#hierarchyLinks{position:absolute;margin-top:-4em}",lr='body[data-page=page]>div#root>div>main>div#app-container div#main-content-container{& div{&.page-hierarchy{&:not(.th-journal) ul.namespaces{padding:.6em .1em 1em;font-size:.93em;>li{list-style:decimal-leading-zero;& span.page-reference{&:not(:last-child){display:none}+span:not(.page-reference){visibility:hidden;&:after{content:">";visibility:visible}}}&:first-child{& span{&.page-reference+span+span.page-reference{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}+span.page-reference:last-child:before{pointer-events:none}}}}}&:not(:has(ul li:first-of-type span.page-reference[data-ref*="/"])){display:none}}&.page-tags{& ul{list-style:circle;font-size:.93em;padding:.6em 1em 1em;>li{list-style:decimal-leading-zero}}}}}',Ki=()=>[{key:"headingHierarchyOfPageName",title:le("Hierarchy of page-title settings"),type:"heading",default:"",description:""},{key:"booleanSplitHierarchy",title:le("Split page title hierarchy as links (non-journals)"),type:"boolean",default:!0,description:"default: true"},{key:"booleanRemoveHierarchyPageTitle",title:le("Remove hierarchies of the page title (if the above option is enabled)"),type:"boolean",default:!0,description:"default: true"},{key:"headingHierarchy",title:le("Hierarchy settings"),type:"heading",default:"",description:""},{key:"booleanModifyHierarchy",title:le("Delete the hierarchy from the beginning level"),type:"boolean",default:!0,description:le("Modify the display of hierarchy to be original rather than standard.")},{key:"booleanHierarchyForFirstLevelOnly",title:le("Hierarchy for first level only"),type:"boolean",default:!1,description:"default: false"},{key:"headingPageView",title:le("Page view settings"),type:"heading",default:"",description:""},{key:"booleanUnlinkedReferences",title:le("Hide unlinked references"),type:"boolean",default:!1,description:"default: false"},{key:"placeSelect",title:le("Select mode"),type:"enum",enumChoices:["unset","side","bottom","wide view"],default:"unset",description:le("[unset, side, bottom, wide view]")+` [more details](${le("https://github.com/YU000jp/logseq-page-tags-and-hierarchy/wiki/Page-View-UI")})`},{key:"headingWideView mode",title:le("Wide view mode settings"),type:"heading",default:"",description:`
        - ${le("Require scroll to right space.")}
        - ${le("If workspace is small, zoom in or open it in the right sidebar.")}
        `},{key:"booleanTableOfContents",title:le("Enable table of contents on a page"),type:"boolean",default:!0,description:"default: true"},{key:"booleanTableOfContentsHide",title:le("Collapsed table of contents by default"),type:"boolean",default:!1,description:"default: false"},{key:"tocRemoveWordList",title:le("Remove words from table of contents"),type:"string",inputAs:"textarea",default:"",description:le("Separate with line breaks")},{key:"booleanWideModeJournalQueries",title:le("Showing journal queries on today journal page"),type:"boolean",default:!1,description:"default: false"},{key:"enumScheduleDeadline",title:le("Scheduled and deadline position"),type:"enum",enumChoices:["1","2","3","4","5","6"],default:"1",description:"default: 1"},{key:"enumTableOfContents",title:le("Table of contents position"),type:"enum",enumChoices:["1","2","3","4","5","6"],default:"2",description:"default: 2"},{key:"enumLinkedReferences",title:le("Linked references position"),type:"enum",enumChoices:["1","2","3","4","5","6"],default:"3",description:"default: 3"},{key:"enumUnlinkedReferences",title:le("Unlinked references position"),type:"enum",enumChoices:["1","2","3","4","5","6"],default:"4",description:"default: 4"},{key:"enumPageHierarchy",title:le("Page hierarchy position"),type:"enum",enumChoices:["1","2","3","4","5","6"],default:"5",description:"default: 5"},{key:"enumPageTags",title:le("Page tags position"),type:"enum",enumChoices:["1","2","3","4","5","6"],default:"6",description:"default: 6"}],cr='body[data-page=page]:not(.is-pdf-active){@media screen and (max-width:899px){& div#main-content-container :is(div.page-hierarchy,div.references.page-tags){display:none}}@media screen and (min-width:900px){& main:not(.ls-right-sidebar-open) div#main-content-container{& div.references.page-tags,div.page-hierarchy{font-size:.91em;background-color:var(--ls-primary-background-color);outline-offset:2px;outline:2px solid var(--ls-table-tr-even-background-color);border-radius:10px;overflow:scroll;white-space:nowrap;position:fixed;border:2px solid var(--ls-border-color);box-shadow:0 0 7px var(--ls-border-color)}}& div#main-content-container{& div.flex-1.page.relative{margin-bottom:2em;margin-top:2em;margin-left:1.5em}& div.page-hierarchy,div.references.page-tags{max-height:40vh;padding:.9em;& div.foldable-title h2{cursor:pointer;opacity:.5;&:before{content:"▽";margin-right:.5em}}}& div.references.page-tags{top:2em;right:1em}& div.page-hierarchy{right:1em;bottom:3em}}&.is-tabs-loaded main:not(.ls-right-sidebar-open) div#main-content-container div.references.page-tags{top:4.5em}}@media screen and (min-width:900px) and (max-width:1500px){& main:not(.ls-right-sidebar-open){& div#main-content-container{& div.page-hierarchy,div.references.page-tags{min-width:230px;max-width:280px;&:has(div.content div.hidden){padding:unset}}}}}@media screen and (min-width:1501px){& main:not(.ls-right-sidebar-open){& div#main-container{padding-right:20vw}& div#main-content-container{& div.page-hierarchy,div.references.page-tags{width:19vw;min-width:250px;max-width:390px}}}}& main.ls-wide-mode div#main-content-container div.cp__sidebar-main-content{max-width:1450px}& div#right-sidebar :is(div.page-hierarchy,div.references.page-tags),main.ls-right-sidebar-open div#main-content-container :is(div.page-hierarchy,div.references.page-tags){display:none}}',Vr=async l=>{if(parent.document.getElementById("hierarchyLinks")!==null)return;const s=parent.document.body.querySelector("div#root>div>main div#main-content-container h1.page-title");if(s===null||l.includes("[[")&&l.includes("]]"))return;const v=l.split("/");logseq.settings.booleanRemoveHierarchyPageTitle===!0&&Qr(v.pop(),l);const D=document.createElement("span");D.id="hierarchyLinks",s.insertAdjacentElement("beforebegin",D);let A="";for(const[ee,F]of v.entries()){if(A==="")A=F;else if(ee!==v.length)A+="/"+F,D.insertAdjacentText("beforeend"," / ");else return;const c=document.createElement("a");c.className="page-ref",c.dataset.checked="",c.dataset.localize="",c.dataset.ref=A,c.textContent=F,D.insertAdjacentElement("beforeend",c),c.addEventListener("click",({shiftKey:O})=>{c.dataset.ref&&Xi(c.dataset.ref,O)})}},Qr=async(l,s)=>{const v=parent.document.querySelector("body>div#root>div>main div#main-content-container div.page.relative:not(.is-journals) div.ls-page-title h1.page-title span.title");!v||v.innerText===l||(v.innerText=l,setTimeout(()=>{const D=new MutationObserver(ee=>{for(const F of ee)if(F.type==="childList"){for(const c of F.removedNodes)if(c.nodeName==="SPAN")if(v.innerText===s){v.innerText=l;return}else D.disconnect()}}),A=v.parentElement;A&&D.observe(A,{childList:!0})},300))},Xi=async(l,s)=>{const v=await logseq.Editor.getPage(l);v&&(s?logseq.Editor.openInRightSidebar(v.uuid):logseq.App.replaceState("page",{name:l}))},Hr=()=>{const s=parent.document.querySelector("div#main-content-container h1.page-title span.title");s&&(s.innerText=s.dataset.ref)},Ur=()=>{const s=parent.document.querySelector("div#main-content-container h1.page-title span.title");if(s){const v=s.innerText,D=v.split("/");if(D.length>1){const A=D.pop();s.innerText=A,Qr(A,v)}}};var eo=function(l,s){s=s||{},s.listUnicodeChar=s.hasOwnProperty("listUnicodeChar")?s.listUnicodeChar:!1,s.stripListLeaders=s.hasOwnProperty("stripListLeaders")?s.stripListLeaders:!0,s.gfm=s.hasOwnProperty("gfm")?s.gfm:!0,s.useImgAltText=s.hasOwnProperty("useImgAltText")?s.useImgAltText:!0,s.abbr=s.hasOwnProperty("abbr")?s.abbr:!1,s.replaceLinksWithURL=s.hasOwnProperty("replaceLinksWithURL")?s.replaceLinksWithURL:!1,s.htmlTagsToSkip=s.hasOwnProperty("htmlTagsToSkip")?s.htmlTagsToSkip:[];var v=l||"";v=v.replace(/^(-\s*?|\*\s*?|_\s*?){3,}\s*/gm,"");try{s.stripListLeaders&&(s.listUnicodeChar?v=v.replace(/^([\s\t]*)([\*\-\+]|\d+\.)\s+/gm,s.listUnicodeChar+" $1"):v=v.replace(/^([\s\t]*)([\*\-\+]|\d+\.)\s+/gm,"$1")),s.gfm&&(v=v.replace(/\n={2,}/g,`
`).replace(/~{3}.*\n/g,"").replace(/~~/g,"").replace(/`{3}.*\n/g,"")),s.abbr&&(v=v.replace(/\*\[.*\]:.*\n/,"")),v=v.replace(/<[^>]*>/g,"");var D=new RegExp("<[^>]*>","g");if(s.htmlTagsToSkip.length>0){var A="(?!"+s.htmlTagsToSkip.join("|")+")";D=new RegExp("<"+A+"[^>]*>","ig")}v=v.replace(D,"").replace(/^[=\-]{2,}\s*$/g,"").replace(/\[\^.+?\](\: .*?$)?/g,"").replace(/\s{0,2}\[.*?\]: .*?$/g,"").replace(/\!\[(.*?)\][\[\(].*?[\]\)]/g,s.useImgAltText?"$1":"").replace(/\[([^\]]*?)\][\[\(].*?[\]\)]/g,s.replaceLinksWithURL?"$2":"$1").replace(/^\s{0,3}>\s?/gm,"").replace(/^\s{1,2}\[(.*?)\]: (\S+)( ".*?")?\s*$/g,"").replace(/^(\n)?\s{0,}#{1,6}\s+| {0,}(\n)?\s{0,}#{0,} #{0,}(\n)?\s{0,}$/gm,"$1$2$3").replace(/([\*]+)(\S)(.*?\S)??\1/g,"$2$3").replace(/(^|\W)([_]+)(\S)(.*?\S)??\2($|\W)/g,"$1$3$4$5").replace(/(`{3,})(.*?)\1/gm,"$2").replace(/`(.+?)`/g,"$1").replace(/~(.*?)~/g,"$1")}catch(ee){return console.error(ee),l}return v};const to=Gi(eo);function no(l){return l.includes("[[")&&(l=l.replaceAll(/\[\[/g,"")),l.includes("]]")&&(l=l.replaceAll(/\]\]/g,"")),l}function ro(l){return l.includes("[")&&(l=l.replaceAll(/\[([^\]]+)\]\(([^\)]+)\)/g,"$1")),l}function io(l){return l.length>140&&(l=l.substring(0,140)+"..."),l}function oo(l){return l.includes("![")&&(l=l.replaceAll(/!\[[^\]]+\]\([^\)]+\)/g,"")),l}async function ao(l,s,v){const D=l[s].properties;if(!D)return v;const A=Object.keys(D);for(let ee=0;ee<A.length;ee++){let F=A[ee];const c=D[F];F=F.replace(/([A-Z])/g,"-$1").toLowerCase(),v=v.replace(`${F}:: ${c}`,""),v=v.replace(`${F}::`,"")}return v}const so=l=>{const s=logseq.settings.tocRemoveWordList.split(`
`);for(let v=0;v<s.length;v++)s[v]!==""&&(l=l.replaceAll(new RegExp(s[v],"g"),""));return l};function lo(l){const s=parent.document.getElementById("tocContentTitle");!s||s.dataset.PageName===l||(s.dataset.pageName=l,s.onclick=async()=>{const v=parent.document.getElementById("tocInPage");v&&(v.parentElement?.classList.contains("initial")?(v.parentElement.classList.remove("initial"),v.parentElement.classList.add("hidden")):(v.parentElement.classList.remove("hidden"),v.parentElement.classList.add("initial")))})}async function co(){const l=parent.document.querySelector('body[data-page="page"]>div#root>div>main div#main-content-container div.page.relative');if(!l||l.querySelector("div.th-toc")!==null)return;const s=document.createElement("div");s.classList.add("th-toc"),s.classList.add("mt-6"),s.innerHTML=`
    <div class="flex flex-col">
      <div class="content">
        <div id="tocContentTitle" class="flex-1 flex-row foldable-title cursor">
          <div class="flex flex-row items-center">
          <h2 class="font-medium">Table of Contents</h2>
          </div>
        </div>
      </div>
      <div class="${logseq.settings.booleanTableOfContentsHide===!0?"hidden":"initial"}">
      <div id="tocInPage" class="my-2 color-level px-2 py-2 rounded ls-block"></div>
      </div>
    </div>
    `,l.append(s)}const uo=l=>{let s=[];const v=D=>{if(D)for(let A=0;A<D.length;A++)if((D[A].content.startsWith("# ")||D[A].content.startsWith("## ")||D[A].content.startsWith("### ")||D[A].content.startsWith("#### ")||D[A].content.startsWith("##### ")||D[A].content.startsWith("###### ")||D[A].content.startsWith("####### "))&&s.push({content:D[A].content,uuid:D[A].uuid,properties:D[A].properties}),D[A].children)v(D[A].children);else return};return v(l),s},po=async(l,s,v)=>{const D=document.createElement("div"),A=document.createElement("span");A.classList.add("cursor"),A.innerHTML="🔄 Update",A.style.padding="1em",D.append(A),A.addEventListener("click",()=>{A.style.visibility="hidden",setTimeout(()=>A.style.visibility="visible",2e3),on(v)}),D.append(document.createElement("span").innerHTML="/");const ee=document.createElement("span");ee.classList.add("cursor"),ee.innerHTML="⬆️ Scroll to top",ee.style.padding="1em",D.append(ee),ee.addEventListener("click",()=>parent.document.querySelector('body[data-page="page"]>div#root>div>main div#main-content-container h1.page-title').scrollIntoView({behavior:"smooth"})),l.append(D);for(let F=0;F<s.length;F++){let c=s[F].content;if(c.includes("((")&&c.includes("))")){const I=/\(([^(())]+)\)/.exec(c);if(!I)continue;const T=await logseq.Editor.getBlock(I[1],{includeChildren:!0});if(!T)continue;c=c.replace(`((${I[1]}))`,T.content.substring(0,T.content.indexOf("id::")))}if(c=await ao(s,F,c),c.includes("id:: ")&&(c=c.substring(0,c.indexOf("id:: "))),c=no(c),c=ro(c),c=io(c),c=oo(c),c=so(c),c.startsWith("# ")||c.startsWith("## ")||c.startsWith("### ")||c.startsWith("#### ")||c.startsWith("##### ")||c.startsWith("###### ")||c.startsWith("####### ")){const O=c.startsWith("# ")?document.createElement("h1"):c.startsWith("## ")?document.createElement("h2"):c.startsWith("### ")?document.createElement("h3"):c.startsWith("#### ")?document.createElement("h4"):c.startsWith("##### ")?document.createElement("h5"):document.createElement("h6");O.classList.add("cursor"),O.title=O.tagName.toLowerCase(),O.innerHTML=to(`${c.includes("collapsed:: true")&&c.substring(2,c.length-16)||c.substring(2)}`),setTimeout(()=>{O.addEventListener("click",({shiftKey:I})=>fo(I,v,s[F].uuid))},800),l.append(O)}}};async function fo(l,s,v){if(l)logseq.Editor.openInRightSidebar(v);else{const D=parent.document.getElementById("block-content-"+v);D?(D.scrollIntoView({behavior:"smooth"}),setTimeout(()=>logseq.Editor.selectBlock(v),50)):await ho(v)}}async function ho(l){const s=await logseq.Editor.getBlock(l);if(!s)return;const v=await logseq.Editor.getBlock(s.parent.id);if(!v)return;await logseq.Editor.setBlockCollapsed(v.uuid,!1);const D=parent.document.getElementById("block-content-"+s.uuid);D?(D.scrollIntoView({behavior:"smooth"}),setTimeout(()=>logseq.Editor.selectBlock(s.uuid),50)):await Yr(v)}async function Yr(l){if(l.parent){const s=await logseq.Editor.getBlock(l.parent.id);if(s){await logseq.Editor.setBlockCollapsed(s.uuid,!1);const v=parent.document.getElementById("block-content-"+s.uuid);v?(v.scrollIntoView({behavior:"smooth"}),setTimeout(()=>logseq.Editor.selectBlock(l.uuid),50)):await Yr(s)}}}const ur=l=>`
body[data-page="page"]>div#root>div>main div#main-content-container div.page.relative>div {
  &.lazy-visibility:has(>div>div.fade-enter-active>div.scheduled-or-deadlines) {order:${l.enumScheduleDeadline}}
  &.th-toc {order:${l.enumTableOfContents}}
  &:has(>div.lazy-visibility>div>div.fade-enter-active>div.references.page-linked) {order:${l.enumLinkedReferences}}
  &:has(>div.references.page-unlinked) {order:${l.enumUnlinkedReferences}}
  &.page-hierarchy {order:${l.enumPageHierarchy}}
  &.page-tags {order:${l.enumPageTags}}
}
`,go={"Collapsed table of contents by default":"デフォルトで目次を折りたたみます","Delete the hierarchy from the beginning level":"階層を最初のレベルから削除する","Enable table of contents on a page":"ページで目次を有効にします","Hide unlinked references":"Unlinked Referencesを非表示にする","Hierarchy for first level only":"階層は1レベルのみ","Hierarchy of page-title settings":"ページタイトルの階層設定","Hierarchy settings":"階層の設定","If workspace is small, zoom in or open it in the right sidebar.":"ワークスペースが小さい場合は、ズームインするか、右サイドバーで開きます。","Linked references position":"Linked Referencesの位置","Modify the display of hierarchy to be original rather than standard.":"階層の表示方法を、標準ではなくオリジナルに変更します","Page hierarchy position":"ページ階層の位置","Page tags position":"ページタグの位置","Page view settings":"ページビューの設定","Remove hierarchies of the page title (if the above option is enabled)":"ページ名に含まれる階層を削除（上記のオプションが有効な場合）","Remove words from table of contents":"目次から単語を削除する","Require scroll to right space.":"右スペースにスクロールする必要があります。横スクロール対応のマウスではない場合は、不向きです。","Scheduled and deadline position":"スケジュールと締切位置","Select mode":"モードを選択します","Separate with line breaks":"改行で区切る","Showing journal queries on today journal page":"今日の日記で日誌クエリーを表示します","Split page title hierarchy as links (non-journals)":"ページ名に階層がある場合にリンクとして分割する（日誌以外）","Table of contents position":"目次の位置","Unlinked references position":"Unlinked Referencesの位置","Wide view mode settings":"ワイドビューモードの設定","[unset, side, bottom, wide view]":"[設定しない, 右サイド, 下側, ワイドビュー] ","https://github.com/YU000jp/logseq-page-tags-and-hierarchy/wiki/Page-View-UI":"https://github.com/YU000jp/logseq-page-tags-and-hierarchy/wiki/%E3%83%9A%E3%83%BC%E3%82%B8%E3%83%93%E3%83%A5%E3%83%BCUI","plugin settings":"プラグイン設定"},mo={"Collapsed table of contents by default":"기본값으로 목차 축소","Delete the hierarchy from the beginning level":"시작 레벨에서 계층 삭제","Enable table of contents on a page":"페이지에서 목차 활성화","Hide unlinked references":"연결되지 않은 참조 숨기기","Hierarchy for first level only":"첫 번째 레벨의 계층만","Hierarchy of page-title settings":"페이지 제목 계층 설정","Hierarchy settings":"계층 설정","If workspace is small, zoom in or open it in the right sidebar.":"작업 공간이 작으면 확대하거나 오른쪽 사이드바에서 열기","Linked references position":"연결된 참조 위치","Modify the display of hierarchy to be original rather than standard.":"표준 대신 원본 계층 표시 수정","Page hierarchy position":"페이지 계층 위치","Page tags position":"페이지 태그 위치","Page view settings":"페이지 보기 설정","Remove hierarchies of the page title (if the above option is enabled)":"페이지 제목의 계층 제거 (위의 옵션이 활성화된 경우)","Remove words from table of contents":"목차에서 단어 제거","Require scroll to right space.":"오른쪽 공간으로 스크롤 필요. 가로 스크롤 지원하지 않는 마우스로는 부적합합니다.","Scheduled and deadline position":"일정 및 마감 위치","Select mode":"모드 선택","Separate with line breaks":"줄 바꿈으로 구분","Showing journal queries on today journal page":"오늘의 저널 페이지에 저널 쿼리 표시","Split page title hierarchy as links (non-journals)":"페이지 제목 계층을 링크로 분할 (저널 제외)","Table of contents position":"목차 위치","Unlinked references position":"연결되지 않은 참조 위치","Wide view mode settings":"와이드 뷰 모드 설정","[unset, side, bottom, wide view]":"[설정하지 않음, 사이드, 하단, 와이드 뷰]","plugin settings":"플러그인 설정"},vo={"Collapsed table of contents by default":"默认折叠目录","Delete the hierarchy from the beginning level":"从起始级别删除层次结构","Enable table of contents on a page":"在页面上启用目录","Hide unlinked references":"隐藏未链接的引用","Hierarchy for first level only":"仅限第一级的层次结构","Hierarchy of page-title settings":"页面标题层次结构设置","Hierarchy settings":"层次结构设置","If workspace is small, zoom in or open it in the right sidebar.":"如果工作区较小，请缩小或在右侧边栏中打开。","Linked references position":"链接引用位置","Modify the display of hierarchy to be original rather than standard.":"修改层次结构的显示方式，使其原汁原味而不是标准","Page hierarchy position":"页面层次结构位置","Page tags position":"页面标签位置","Page view settings":"页面视图设置","Remove hierarchies of the page title (if the above option is enabled)":"删除页面标题中的层次结构（如果上述选项已启用）","Remove words from table of contents":"从目录中删除单词","Require scroll to right space.":"需要滚动到右侧的空间。如果您的鼠标不支持横向滚动，则不适用。","Scheduled and deadline position":"计划和截止日期位置","Select mode":"选择模式","Separate with line breaks":"用换行符分隔","Showing journal queries on today journal page":"在今天的日志页面上显示日志查询","Split page title hierarchy as links (non-journals)":"将页面标题中的层次结构拆分为链接（非期刊）","Table of contents position":"目录位置","Unlinked references position":"未链接引用位置","Wide view mode settings":"宽视图模式设置","[unset, side, bottom, wide view]":"[未设置，侧边，底部，宽视图]","https://github.com/YU000jp/logseq-page-tags-and-hierarchy/wiki/Page-View-UI":"https://github.com/YU000jp/logseq-page-tags-and-hierarchy/wiki/%E9%A1%B5%E9%9D%A2%E8%A7%86%E5%9B%BE%E7%95%8C%E9%9D%A2","plugin settings":"插件设置"},yo={"Collapsed table of contents by default":"默認折疊目錄","Delete the hierarchy from the beginning level":"從開始級別刪除層次結構","Enable table of contents on a page":"在頁面上啟用目錄","Hide unlinked references":"隱藏未連結的參考","Hierarchy for first level only":"僅為第一級的層次結構","Hierarchy of page-title settings":"頁面標題層次結構設置","Hierarchy settings":"層次結構設置","If workspace is small, zoom in or open it in the right sidebar.":"如果工作區較小，請放大或在右側欄中打開它。","Linked references position":"已連結的參考位置","Modify the display of hierarchy to be original rather than standard.":"修改層次結構的顯示方式，使其原始而不是標準。","Page hierarchy position":"頁面層次結構位置","Page tags position":"頁面標籤位置","Page view settings":"頁面檢視設置","Remove hierarchies of the page title (if the above option is enabled)":"刪除頁面標題中的層次結構（如果啟用上述選項）","Remove words from table of contents":"從目錄中刪除單詞","Require scroll to right space.":"需要向右滾動以獲得足夠的空間。不適用於不支援橫向滾動的滑鼠。","Scheduled and deadline position":"計劃和截止位置","Select mode":"選擇模式","Separate with line breaks":"用換行符分隔","Showing journal queries on today journal page":"在今天的日誌頁面上顯示日誌查詢","Split page title hierarchy as links (non-journals)":"將頁面標題的層次結構作為鏈接拆分（非期刊）","Table of contents position":"目錄位置","Unlinked references position":"未連結的參考位置","Wide view mode settings":"寬視圖模式設置","[unset, side, bottom, wide view]":"[未設置，側邊，底部，寬視圖]","https://github.com/YU000jp/logseq-page-tags-and-hierarchy/wiki/Page-View-UI":"https://github.com/YU000jp/logseq-page-tags-and-hierarchy/wiki/%E9%A1%B5%E9%9D%A2%E8%A7%86%E5%9B%BE%E7%95%8C%E9%9D%A2","plugin settings":"插件設置"},Zr="body[data-page=page]>div#root>div>main div#main-content-container div.page.relative>div:has(>div.references.page-unlinked){display:none}",Kr="body[data-page=page]{>div#root>div>main div{&#main-content-container{&::-webkit-scrollbar{height:1.2em}& div{&.cp__sidebar-main-content{max-width:unset}&#tocInPage{font-size:.86em;padding:1em 1.3em 1.6em .3em;user-select:none;>div{margin-bottom:1.2em}& h1,h2,h3,h4,h5,h6{&:hover{border-radius:2px;background-color:var(--ls-block-highlight-color);transition:background-color .2s cubic-bezier(0,1,0,1)}}& h1{font-size:1.6em;margin-top:.8em}& h2{font-size:1.4em;padding-left:.6em;outline:1px solid var(--ls-quaternary-background-color);border-bottom:unset;margin-top:.6em}& h2,h3,h4,h5,h6{margin-top:.5em;display:list-item;list-style-type:disc;list-style-position:inside}& h3,h4,h5,h6{padding-top:.6em}& h3{padding-left:1.2em}& h4{padding-left:2em}& h5{padding-left:2.8em}& h6{padding-left:3.6em}}&.page.relative{display:flex;>div{& div#tocInPage,div:is(.page-linked,.page-unlinked)>div.content>div>div.initial,&:is(.page-tags,.page-hierarchy) div.initial{max-height:86vh;overflow:auto}&.relative{min-width:1100px;max-width:1450px;flex:1}&:not(.relative){padding:1em;height:fit-content;position:sticky;top:0;&.mt-6{margin-top:unset}&:has(div.content+div.initial){flex:.3;min-width:300px;max-width:fit-content}&:not(#today-queries):has(div.content>div.flex>div.content+div.hidden),&.lazy-visibility:has(div>div.fade-enter-active>div.scheduled-or-deadlines>div.flex>div.content+div.hidden),&:is(.page-hierarchy,.th-toc):has(div.flex>div.content+div.hidden){writing-mode:vertical-rl;max-width:3.2em}}>div.page-unlinked.mt-6{margin-top:unset}&.page-tags,&.page-hierarchy{padding:1em;& div{&.initial{font-size:.9em}&.foldable-title h2{opacity:unset;font-weight:500;cursor:pointer}}}&.page-hierarchy{& div.foldable-title h2{user-select:none}&:has(>div>div.content+div.initial){max-width:580px;min-width:300px}}&.page-tags:has(>div.content>div>div.content+div.initial){max-width:480px;min-width:300px}}>div>div{&.lazy-visibility>div>div.fade-enter-active>div.references.page-linked div.pt-6{padding-top:unset}&.lazy-visibility>div>div.fade-enter-active>div.references.page-linked,&.references.page-unlinked{font-size:.96em;overflow-y:auto;&:has(>div.content+div.initial){min-width:400px;max-width:570px;&:focus-within{min-width:500px}}}&.lazy-visibility>div>div.fade-enter-active>div.references.page-linked{display:none}}&.is-journals>div.lazy-visibility{&:has(>div>div.fade-enter-active>div.scheduled-or-deadlines.mt-8>div.flex>div.content+div.initial){min-width:480px;max-width:650px;&:focus-within{min-width:550px}}>div>div.fade-enter-active>div.scheduled-or-deadlines.mt-8{margin-top:unset;& div.foldable-title a.block-control{display:none}}}}}}&#right-sidebar div.page.relative>div.relative{min-width:94%}&#main-content-container,&#right-sidebar{& div.is-journals div#today-queries{display:none}}}&.is-awSt-enabled>div#root>div>main>div#app-container div#main-content-container{& div{&.page.relative{gap:.5em;& div.mt-6{margin-top:unset}>div{&.relative{margin-right:1.5em}&:not(.relative){background-color:var(--ls-primary-background-color);border-radius:7px}}}&.cp__sidebar-main-content>div{margin-left:unset}}}}",dr="body[data-page=page]>div#root>div>main div:is(#main-content-container,#right-sidebar) div.is-journals div#today-queries{max-height:88vh;overflow:scroll;min-width:500px;max-width:500px;display:unset}";let je="";const tn="th-PageAccessory",Ot="th-nestingPageAccessory",Ut="th-side",nn="th-bottom",rn="th-wide",Tt="th-pageAccessoryOrder",Ht="th-wideModeJournalQueries",pr="th-unlinkedReferences-hidden",Xr="th-hierarchyForFirstLevelOnly",bo="th-hierarchyRemoveBeginningLevel",wo=async()=>{switch(await Ji({builtinTranslations:{ja:go,ko:mo,"zh-Hant":yo,"zh-CN":vo}}),logseq.useSettingsSchema(Ki()),logseq.settings?.booleanModifyHierarchy===!0&&sr(Ot,lr),logseq.settings.booleanUnlinkedReferences===!0&&logseq.provideStyle({key:pr,style:Zr}),logseq.settings.placeSelect){case"unset":break;case"bottom":logseq.provideStyle({key:nn,style:Gr});break;case"side":logseq.provideStyle({key:Ut,style:cr});break;case"Side":logseq.provideStyle({key:Ut,style:cr}),logseq.updateSettings({placeSelect:"side"});break;case"wide view":logseq.provideStyle({key:rn,style:Kr}),logseq.provideStyle({key:Tt,style:ur(logseq.settings)}),logseq.settings.booleanWideModeJournalQueries===!0&&logseq.provideStyle({key:Ht,style:dr});break}logseq.provideStyle(Zi),logseq.App.onRouteChanged(async({template:l})=>{l==="/page/:name"&&Dr()}),logseq.App.onPageHeadActionsSlotted(async()=>Dr()),logseq.settings.placeSelect==="wide view"&&logseq.settings.booleanTableOfContents===!0&&Fn(),_o(),logseq.App.registerUIItem("toolbar",{key:"toolbarPageTagsAndHierarchy",template:`<div><a class="button icon" data-on-click="toolbarPageTagsAndHierarchy" style="font-size:15px;color:#1f9ee1;opacity:unset" title="Page-tags and Hierarchy: ${le("plugin settings")}">🏷️</a></div>`}),logseq.provideModel({toolbarPageTagsAndHierarchy:()=>logseq.showSettingsUI()}),logseq.beforeunload(async()=>{const l=parent.document.getElementById("hierarchyLinks");l&&l.remove()})};let Ln=!1;const Dr=async()=>{if(Ln===!0)return;Ln=!0,setTimeout(()=>Ln=!1,1e3);const l=await logseq.Editor.getCurrentPage();l&&(je=l.originalName,logseq.settings.booleanSplitHierarchy===!0&&je&&je.includes("/")===!0&&!(l.journal===!0&&je.includes(","))&&Vr(je),logseq.settings.placeSelect==="wide view"&&logseq.settings.booleanTableOfContents===!0&&on(je)),logseq.settings.booleanModifyHierarchy===!0&&je&&(je.match(/^\d{4}/)||je.match(/^(\d{4}\/\d{2})/))&&parent.document.querySelector('body[data-page="page"]>div#root>div>main div#main-content-container div.page-hierarchy')?.classList.add("th-journal"),setTimeout(()=>{const s=parent.document.querySelector('body[data-page="page"]>div#root>div>main div#main-content-container div.page.relative div.page-tags');if(s){const v=s.querySelector('body[data-page="page"]>div#root>div>main div.content div.foldable-title h2'),D=s.querySelector("div.initial");v&&D&&Yi(v,D)}(logseq.settings.booleanHierarchyForFirstLevelOnly===!0||logseq.settings.booleanRemoveBeginningLevel===!0)&&(logseq.settings.booleanHierarchyForFirstLevelOnly===!0&&Jr(je.split("/")),Vi(je.split("/")))},100),logseq.settings.placeSelect==="wide view"&&setTimeout(()=>{const s=parent.document.querySelector('body[data-page="page"]>div#root>div>main div#main-content-container div.page.relative>div>div.lazy-visibility>div>div.fade-enter-active>div.references.page-linked');s&&(s.style.display="block")},300),Ln=!1};let Pn=!1,fr=!1;const Fn=()=>{fr!==!0&&(fr=!0,logseq.DB.onChanged(async({blocks:l})=>{if(Pn===!0||je===""||logseq.settings.booleanTableOfContents===!1)return;const s=l.find(D=>D.properties?.heading);if(!s)return;const v=s?s.uuid:null;zr(),v&&logseq.DB.onBlockChanged(v,async()=>zr())}))},zr=()=>{Pn!==!0&&(Pn=!0,setTimeout(async()=>{await on(je),Pn=!1},300))},_o=()=>{logseq.onSettingsChanged(async(l,s)=>{if(s.placeSelect!==l.placeSelect){if(s.placeSelect==="wide view"&&l.placeSelect!=="wide view")$r("th-toc");else if(s.placeSelect!=="wide view"&&l.placeSelect==="wide view"){const v=await logseq.Editor.getCurrentPage();v&&v.name&&on(v.name),Fn()}switch(l.booleanModifyHierarchy===!0&&!parent.document.head.querySelector(`style[data-injected-style^="${tn}"]`)?sr(Ot,lr):l.booleanModifyHierarchy===!1&&(pe(tn),pe(Ot)),l.placeSelect){case"bottom":pe(Ut),pe(rn),pe(Tt),pe(Ht),logseq.provideStyle({key:nn,style:Gr});break;case"side":pe(nn),pe(rn),pe(Tt),logseq.provideStyle({key:Ut,style:cr});break;case"wide view":pe(Ut),pe(nn),logseq.provideStyle({key:rn,style:Kr}),logseq.provideStyle({key:Tt,style:ur(logseq.settings)}),l.booleanWideModeJournalQueries===!0&&logseq.provideStyle({key:Ht,style:dr});break;case"unset":pe(Ut),pe(nn),pe(rn),pe(Tt),pe(Ht),pe(tn),pe(Ot);break}}else{if(s.booleanUnlinkedReferences===!0&&l.booleanUnlinkedReferences===!1?pe(pr):s.booleanUnlinkedReferences===!1&&l.booleanUnlinkedReferences===!0&&logseq.provideStyle({key:pr,style:Zr}),s.booleanHierarchyForFirstLevelOnly===!0&&l.booleanHierarchyForFirstLevelOnly===!1?pe(Xr):s.booleanHierarchyForFirstLevelOnly===!1&&l.booleanHierarchyForFirstLevelOnly===!0&&je&&Jr(je.split("/")),s.booleanModifyHierarchy===!1&&l.booleanModifyHierarchy===!0?!parent.document.head.querySelector(`style[data-injected-style^="${tn}"]`)&&!parent.document.head.querySelector(`style[data-injected-style^="${Ot}"]`)&&sr(Ot,lr):s.booleanModifyHierarchy===!0&&l.booleanModifyHierarchy===!1&&(pe(tn),pe(Ot)),s.booleanTableOfContents===!1&&l.booleanTableOfContents===!0){const v=await logseq.Editor.getCurrentPage();v&&v.name&&on(v.name),Fn()}else s.booleanTableOfContents===!0&&l.booleanTableOfContents===!1&&$r("th-toc");l.placeSelect==="wide view"&&((s.enumScheduleDeadline!==l.enumScheduleDeadline||s.enumTableOfContents!==l.enumTableOfContents||s.enumLinkedReferences!==l.enumLinkedReferences||s.enumUnlinkedReferences!==l.enumUnlinkedReferences||s.enumPageHierarchy!==l.enumPageHierarchy||s.enumPageTags!==l.enumPageTags)&&(pe(Tt),logseq.provideStyle({key:Tt,style:ur(l)})),s.booleanWideModeJournalQueries===!1&&l.booleanWideModeJournalQueries===!0?logseq.provideStyle({key:Ht,style:dr}):s.booleanWideModeJournalQueries===!0&&l.booleanWideModeJournalQueries===!1&&pe(Ht)),s.booleanSplitHierarchy!==l.booleanSplitHierarchy&&(l.booleanSplitHierarchy===!0?(Vr(je),l.booleanRemoveHierarchyPageTitle===!0&&Ur()):l.booleanSplitHierarchy===!1&&(Qi("hierarchyLinks"),Hr())),s.booleanSplitHierarchy===!0&&(s.booleanRemoveHierarchyPageTitle===!1&&l.booleanRemoveHierarchyPageTitle===!0?Ur():s.booleanRemoveHierarchyPageTitle===!0&&l.booleanRemoveHierarchyPageTitle===!1&&Hr())}})},on=async l=>{if(logseq.settings.placeSelect!=="wide view")return;const s=uo(await logseq.Editor.getPageBlocksTree(l));if(s.length>0){const v=parent.document.getElementById("tocInPage");v?v.innerHTML="":await co(),await po(parent.document.getElementById("tocInPage"),s,l),fr===!1&&Fn(),lo(l)}};logseq.ready(wo).catch(console.error);
